<!DOCTYPE html>
<html lang="vi">
<head>
    <!-- Thiết lập metadata và liên kết tài nguyên -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Cổng thông tin học viên lập trình - Xứ Đoàn Các Thánh Tử Đạo Việt Nam - Giáo Xứ Chánh Tòa Mỹ Tho">
    <meta name="keywords" content="Xứ Đoàn, Giáo Xứ Chánh Tòa Mỹ Tho, Các Thánh Tử Đạo Việt Nam, học lập trình, cổng học viên">
    <title>Cổng Học Viên Lập Trình - Xứ Đoàn Các Thánh Tử Đạo Việt Nam</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Định nghĩa biến CSS để tái sử dụng màu sắc và phong cách */
        :root {
            --primary: #cc3048; /* Màu chính */
            --primary-dark: #b7142a; /* Màu chính tối hơn */
            --accent: #FFD700; /* Màu nhấn */
            --dark-bg: #1A1A1A; /* Màu nền tối */
            --text: #E0E0E0; /* Màu chữ */
            --error: #EF4444; /* Màu lỗi */
        }

        /* Thiết lập giao diện cơ bản cho body */
        body {
            background: linear-gradient(135deg, #2D2D2D 0%, #1A1A1A 100%); /* Nền gradient */
            font-family: 'Roboto', sans-serif;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: var(--text);
            overflow-x: hidden;
        }

        /* Tối ưu font cho iOS */
        body.ios {
            font-family: -apple-system, 'SF Pro', 'Roboto', sans-serif;
        }

        /* Popup thông báo quảng cáo */
        #thongbao-quangcao {
            position: fixed;
            bottom: 20px;
            right: 20px;
            max-width: 320px;
            background: #fff8e1;
            border: 1px solid #ffd54f;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 9999;
        }
        #thongbao-quangcao h4 {
            margin-top: 0;
            color: #d17b00;
            font-size: 16px;
        }
        #thongbao-quangcao p {
            margin: 10px 0;
            color: #333;
            line-height: 1.4;
        }
        #thongbao-quangcao img {
            display: block;
            max-width: 100%;
            margin: 10px 0;
        }
        #thongbao-quangcao button {
            background: #ff9800;
            border: none;
            color: white;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            float: right;
        }
        #thongbao-quangcao button:hover {
            background: #e68900;
        }

        /* Header chứa tiêu đề và mô tả trang */
        .header {
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--text);
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
            text-align: center;
        }
        .header h2 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Thanh điều hướng (navbar) */
        .navbar {
            background: var(--dark-bg);
            padding: 0.75rem;
            display: flex;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
        }
        .navbar a {
            color: var(--text);
            padding: 0.75rem 1.5rem;
            margin: 0 0.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s ease;
            position: relative;
        }
        .navbar a:hover {
            background: var(--primary);
            color: var(--accent);
            transform: scale(1.05);
        }
        .navbar a.active {
            background: var(--primary);
            color: var(--accent);
        }

        /* Container chính chứa nội dung */
        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 1.5rem;
            flex: 1;
        }

        /* Card chứa các phần nội dung */
        .card {
            background: #252526;
            border: 1px solid #3C3C3C;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
            margin-bottom: 2rem;
        }
        .card h3 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            color: var(--accent);
            margin-bottom: 1.5rem;
        }

        /* Bảng kết quả học tập */
        .table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 1rem;
        }
        .table th, .table td {
            padding: 1rem;
            border: 1px solid #3C3C3C;
            text-align: left;
            font-size: 0.95rem;
        }
        .table th {
            background: var(--primary);
            color: var(--text);
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        .table td {
            background: #1E1E1E;
        }
        .table tr:hover td {
            background: #2A2A2A;
        }

        /* Icon xếp hạng thành viên */
        .rank-icon {
            font-size: 1.2rem;
        }
        .rank-thanhvien { color: #B0B0B0; }
        .rank-vip { color: #FFD700; }
        .rank-silver { color: #C0C0C0; }
        .rank-gold { color: #FFD700; }
        .rank-diamond { color: #B9F2FF; }
        .rank-vvip { color: #FF69B4; }

        /* Lịch học */
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            background: #252526;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .calendar div {
            padding: 0.75rem;
            text-align: center;
            border: 1px solid #3C3C3C;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .calendar .header {
            background: var(--primary);
            color: var(--text);
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        .calendar .has-event {
            background: var(--accent);
            color: #1A1A1A;
            font-weight: bold;
        }
        .calendar div:hover {
            background: #3C3C3C;
        }

        /* Nút giao diện */
        .btn {
            background: var(--primary);
            color: var(--text);
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            transition: all 0.2s ease;
            position: relative;
        }
        .btn:hover {
            background: var(--primary-dark);
            color: var(--accent);
            transform: translateY(-2px);
        }
        .btn:active {
            transform: translateY(0);
        }

        /* Input và textarea */
        .input, .textarea, select.input {
            background: #1E1E1E;
            border: 1px solid #3C3C3C;
            border-radius: 8px;
            padding: 0.75rem;
            color: var(--text);
            width: 100%;
            font-family: 'JetBrains Mono', monospace;
        }
        .textarea {
            resize: vertical;
            min-height: 150px;
            font-size: 0.9rem;
        }
        .file-input {
            background: #1E1E1E;
            border: 1px solid #3C3C3C;
            border-radius: 8px;
            padding: 0.75rem;
            color: var(--text);
            width: 100%;
            font-family: 'Roboto', sans-serif;
        }

        /* Footer */
        .footer {
            background: var(--dark-bg);
            color: var(--text);
            padding: 2rem 1rem;
            text-align: center;
            box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.3);
            margin-top: auto;
        }
        .footer p {
            margin: 0.2rem 0;
        }
        .highlight {
            color: var(--accent);
            font-weight: 700;
        }
        .contact {
            font-size: 10px;
            color: #D1D5DB;
        }

        /* Canvas cho game */
        #gameCanvas {
            display: block;
            margin: 0 auto;
            border: 2px solid var(--primary);
            border-radius: 8px;
            width: 600px;
            height: 200px;
        }

        /* Tùy chỉnh giao diện cho điện thoại và tablet */
        @media (max-width: 1024px) {
            :root {
                --primary: #e63950;
                --accent: #FFD54F;
            }
            #gameCanvas {
                width: 90vw; /* Chiều rộng canvas bằng 90% màn hình */
                height: 150px; /* Chiều cao canvas tối ưu cho điện thoại */
            }
            .header h2 {
                font-size: 1.0rem;
            }
            .header p {
                font-size: 0.9rem;
            }
            .navbar {
                overflow-x: auto;
                white-space: nowrap;
            }
            .navbar a {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
                display: inline-flex;
                align-items: center;
                transition: transform 0.1s ease, background 0.1s ease;
            }
            .navbar a i {
                margin-right: 0.5rem;
            }
            .navbar a[href="#submit"] {
                display: none !important; /* Ẩn liên kết Nộp Bài trên điện thoại và tablet */
            }
            .navbar a[href="#game"] {
                display: inline-flex; /* Hiển thị liên kết Giải Trí trên điện thoại */
            }
            .card h3 {
                font-size: 1.3rem;
                font-weight: 600;
            }
            .table th, .table td {
                padding: 0.5rem;
                font-size: 0.85rem;
            }
            .calendar div {
                padding: 0.5rem;
                font-size: 0.85rem;
            }
            #thongbao-quangcao {
                max-width: 90%;
                bottom: 10px;
                right: 10px;
                font-size: 12px;
                animation: shake 0.5s ease-in-out;
            }
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                50% { transform: translateX(-5px); }
            }
            .btn:active, .navbar a:active {
                position: relative;
                overflow: hidden;
            }
            .btn:active::after, .navbar a:active::after {
                content: '';
                position: absolute;
                background: rgba(255, 255, 255, 0.3);
                width: 100px;
                height: 100px;
                border-radius: 50%;
                transform: scale(0);
                animation: ripple 0.3s linear;
            }
            @keyframes ripple {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
            #submit {
                display: none; /* Ẩn nội dung phần Nộp Bài trên điện thoại */
            }
            .btn:active {
                background: var(--accent);
                color: var(--dark-bg);
                transform: scale(0.98);
            }
            .footer p {
                font-size: 10px;
            }
            .footer .contact {
                font-size: 10px;
            }
            body.ios {
                font-family: -apple-system, 'SF Pro', 'Roboto', sans-serif;
            }
            body.ios :root {
                --primary: #cc3048;
                --accent: #FFD700;
            }
            body.ios .header h2, body.ios .card h3 {
                font-weight: 500;
            }
            body.ios .navbar {
                position: fixed;
                bottom: 0;
                width: 100%;
                display: flex;
                justify-content: space-around;
                background: rgba(26, 26, 26, 0.95);
                backdrop-filter: blur(10px);
                box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.3);
            }
            body.ios .navbar a {
                flex: 1;
                text-align: center;
                padding: 0.5rem;
                font-size: 0.8rem;
                display: flex;
                flex-direction: column;
                align-items: center;
                transition: transform 0.1s ease-in-out, background 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
            }
            body.ios .navbar a:active {
                transform: scale(0.95);
                box-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
                background: rgba(204, 48, 72, 0.9);
            }
            body.ios .navbar a i {
                font-size: 1.2rem;
                margin-bottom: 0.2rem;
            }
            body.ios #thongbao-quangcao {
                bottom: 10px;
                left: 50%;
                transform: translateX(-50%);
                max-width: 90%;
                background: rgba(255, 248, 225, 0.8);
                backdrop-filter: blur(5px);
            }
            body.ios .btn {
                background: rgba(204, 48, 72, 0.9);
                backdrop-filter: blur(3px);
            }
            body.ios .btn:active {
                transform: scale(0.95);
                transition: transform 0.1s ease;
                box-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
            }
            body.ios #eventDetails {
                position: fixed;
                bottom: 20%;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(26, 26, 26, 0.95);
                backdrop-filter: blur(10px);
                padding: 1rem;
                border-radius: 12px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            }
            #game .mt-4 {
                font-size: 0.85rem;
                padding: 0.5rem;
            }
            #game .btn {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
        }

        /* Tùy chỉnh cho máy tính bảng */
        @media (min-width: 641px) and (max-width: 1024px) {
            .header h2 {
                font-size: 1.75rem;
            }
            .navbar a {
                padding: 0.6rem 1.2rem;
                font-size: 1rem;
            }
            .card h3 {
                font-size: 1.4rem;
            }
            .table th, .table td {
                padding: 0.75rem;
                font-size: 0.9rem;
            }
            .calendar div {
                padding: 0.6rem;
                font-size: 0.9rem;
            }
            .btn:active {
                box-shadow: 0 0 8px var(--accent);
                transform: scale(0.98);
            }
        }

        /* Tùy chỉnh cho laptop */
        @media (min-width: 1025px) {
            .navbar a:hover {
                background: linear-gradient(45deg, var(--primary), var(--accent));
            }
            .tooltip {
                position: absolute;
                background: var(--dark-bg);
                color: var(--text);
                padding: 0.3rem 0.6rem;
                border-radius: 4px;
                font-size: 0.8rem;
                top: 100%;
                display: none;
                z-index: 10;
            }
            label:hover .tooltip {
                display: block;
            }
            .textarea {
                min-height: 300px;
                font-size: 1rem;
            }
            .navbar a[href="#game"] {
                display: none; /* Ẩn liên kết Giải Trí trên laptop */
            }
        }
    </style>
</head>
<body>
    <!-- Popup thông báo thư ngỏ và mã QR -->
    <div id="thongbao-quangcao">
        <h4>THƯ NGỎ</h4>
        <p>
            Chào quý thành viên,<br>
            Chúng chúng tôi là Ban Truyền Thông & Ban Kỹ Thuật của trang web Xứ Đoàn Các Thánh Tử Đạo Việt Nam - Giáo Xứ Chánh Tòa Mỹ Tho.<br><br>
            Đây là trang phi lợi nhuận nhằm kết nối truyền thông với thời đại mới. Các khóa học miễn phí được tổ chức nhằm giúp phát triển kỹ năng và kiến thức, tất cả do quý Trưởng phân công hướng dẫn.<br><br>
            Mong nhận được sự đóng góp và ủng hộ để duy trì hệ thống hoạt động.<br><br>
            <strong>Mã QR hỗ trợ ở bên dưới:</strong>
        </p>
        <img id="qrCode" src="Qr_Code.jpg" alt="Mã QR hỗ trợ">
        <button onclick="document.getElementById('thongbao-quangcao').style.display='none'">Đóng</button>
    </div>

    <!-- Header với tiêu đề và mô tả -->
    <div class="header">
        <h2>XỨ ĐOÀN CÁC THÁNH TỬ ĐẠO VIỆT NAM</h2>
        <p>Cổng Học Viên Lập Trình - Giáo Xứ Chánh Tòa Mỹ Tho</p>
    </div>

    <!-- Thanh điều hướng với các mục -->
    <div class="navbar">
        <a href="#home" class="active"><i class="fas fa-home"></i> Trang Chủ</a>
        <a href="#calendar"><i class="fas fa-calendar"></i> Lịch Học</a>
        <a href="#submit"><i class="fas fa-upload"></i> Nộp Bài</a>
        <a href="#game" class="hidden"><i class="fas fa-gamepad"></i> Giải Trí</a>
        <a href="#feedback"><i class="fas fa-comment"></i> Phản Hồi</a>
    </div>

    <!-- Container chứa các section nội dung -->
    <div class="container">
        <!-- Section Trang Chủ: Hiển thị kết quả học tập -->
        <div id="home" class="card">
            <h3>Kết Quả Học Tập Khoá</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Tên</th>
                        <th>Hạng Thành Viên</th>
                        <th>Môn</th>
                        <th>Thời Lượng</th>
                        <th>Đã Hoàn Tất (%)</th>
                        <th>Điểm</th>
                    </tr>
                </thead>
                <tbody id="subjectsTable"></tbody>
            </table>
        </div>

        <!-- Section Lịch Học: Hiển thị lịch học theo tháng -->
        <div id="calendar" class="card hidden">
            <h3>Lịch Học</h3>
            <div class="flex justify-between mb-4">
                <button class="btn" onclick="prevMonth()">◄</button>
                <h4 id="monthYear" class="font-bold text-accent"></h4>
                <button class="btn" onclick="nextMonth()">►</button>
            </div>
            <div class="calendar" id="calendarGrid"></div>
            <div id="eventDetails" class="mt-4 text-text"></div>
        </div>

        <!-- Section Nộp Bài: Form nộp bài tập -->
        <div id="submit" class="card hidden">
            <h3>Nộp Bài</h3>
            <form id="codeForm" action="https://formsubmit.co/notification2411.huynhdutruong@gmail.com" method="POST" enctype="multipart/form-data">
                <div class="mb-4">
                    <label class="block mb-1 text-text relative">Họ và Tên: <span class="tooltip">Nhập tên đầy đủ hoặc tên Thánh</span></label>
                    <input type="text" name="fullName" id="codeFullName" class="input" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text relative">Ngôn Ngữ: <span class="tooltip">Chọn ngôn ngữ lập trình hoặc loại bài nộp</span></label>
                    <select name="language" class="input" required>
                        <option value="python">Python</option>
                        <option value="javascript">JavaScript</option>
                        <option value="html_css">HTML/CSS</option>
                        <option value="other">Khác (báo cáo, file)</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text relative">Mã Nguồn: <span class="tooltip">Dán mã nguồn (nếu có)</span></label>
                    <textarea name="codeContent" class="textarea" placeholder="Dán mã nguồn của bạn (nếu có)..."></textarea>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text relative">Link Bài Nộp: <span class="tooltip">Dán URL (Google Drive, GitHub, v.v.) nếu không dán code</span></label>
                    <input type="url" name="submissionLink" class="input" placeholder="https://...">
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text relative">File Báo Cáo: <span class="tooltip">Tải lên file (<100MB, PDF, ZIP, TXT, v.v.)</span></label>
                    <input type="file" name="submissionFile" id="submissionFile" class="file-input" accept=".pdf,.zip,.txt,.doc,.docx">
                </div>
                <input type="hidden" name="submissionTime" id="submissionTime">
                <button type="submit" class="btn">Gửi Bài</button>
            </form>
        </div>

        <!-- Section Giải Trí: Chứa game T-Rex (iOS) hoặc Blast Block (Android) -->
        <div id="game" class="card hidden">
            <h3 id="gameTitle">Game</h3>
            <canvas id="gameCanvas"></canvas>
            <div class="mt-4 text-center">
                <p id="gameInstructions"></p>
                <p id="scoreDisplay">Điểm: 0</p>
                <button class="btn" onclick="startGame()">Bắt Đầu Lại</button>
            </div>
        </div>

        <!-- Section Phản Hồi: Form gửi ý kiến -->
        <div id="feedback" class="card hidden">
            <h3>Phản Hồi</h3>
            <form id="feedbackForm" action="https://formsubmit.co/notification2411.huynhdutruong@gmail.com" method="POST">
                <div class="mb-4">
                    <label class="block mb-1 text-text relative">Họ và Tên: <span class="tooltip">Nhập tên đầy đủ hoặc tên Thánh</span></label>
                    <input type="text" name="fullName" id="feedbackFullName" class="input" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text relative">Gmail: <span class="tooltip">Nhập email để nhận phản hồi</span></label>
                    <input type="email" name="gmail" class="input" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text relative">Nội Dung (Tối đa 250 chữ): <span class="tooltip">Mô tả ý kiến của bạn</span></label>
                    <textarea name="content" class="textarea" maxlength="250" required></textarea>
                </div>
                <input type="hidden" name="submissionTime" id="feedbackSubmissionTime">
                <button type="submit" class="btn">Gửi Phản Hồi</button>
            </form>
        </div>
    </div>

    <!-- Footer chứa thông tin bản quyền và liên hệ -->
    <div class="footer">
        <p class="highlight">Bản quyền © 2025 - Xứ Đoàn Các Thánh Tử Đạo Việt Nam</p>
        <p>Giáo Xứ Chánh Tòa Mỹ Tho - Giáo Phận Mỹ Tho - Việt Nam</p>
        <p class="contact">Địa chỉ: 32 Hùng Vương, Phường 7, Thành phố Mỹ Tho, Tiền Giang</p>
    </div>

    <script>
        // Phát hiện thiết bị iOS hoặc Android
        const isIOS = navigator.userAgent.includes('iPhone') || navigator.userAgent.includes('iPad');
        const isAndroid = navigator.userAgent.includes('Android');
        if (isIOS) {
            document.body.classList.add('ios'); // Thêm class ios cho body
            document.getElementById('qrCode').src = 'Qr_Code.jpg'; // Hình QR cho iOS
            document.getElementById('gameTitle').textContent = 'Khủng Long Vượt Chướng Ngại Vật'; // Tiêu đề game T-Rex
            document.getElementById('gameInstructions').innerHTML = 'Nhấn <strong>Space</strong> hoặc chạm màn hình để nhảy. Tránh các chướng ngại vật!'; // Hướng dẫn game T-Rex
        } else if (isAndroid) {
            document.body.classList.add('android'); // Thêm class android cho body
            document.getElementById('qrCode').src = 'Qr_Code.webp'; // Hình QR tối ưu cho Android
            document.getElementById('gameTitle').textContent = 'Blast Block'; // Tiêu đề game Blast Block
            document.getElementById('gameInstructions').innerHTML = 'Chạm vào các khối để phá chúng. Phá càng nhiều khối càng tốt!'; // Hướng dẫn game Blast Block
        }

        // Điều chỉnh kích thước canvas cho game
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        function resizeCanvas() {
            if (window.innerWidth <= 1024) {
                canvas.width = window.innerWidth * 0.9; // Chiều rộng canvas bằng 90% màn hình
                canvas.height = 150; // Chiều cao cố định cho điện thoại
            } else {
                canvas.width = 600; // Chiều rộng mặc định cho desktop
                canvas.height = 200; // Chiều cao mặc định cho desktop
            }
        }
        window.addEventListener('resize', resizeCanvas); // Điều chỉnh canvas khi thay đổi kích thước màn hình
        resizeCanvas(); // Gọi hàm khi tải trang

        // Ẩn liên kết Nộp Bài trên điện thoại và tablet khi tải trang
        window.addEventListener('load', () => {
            if (window.innerWidth <= 1024) {
                document.querySelector('.navbar a[href="#submit"]').style.display = 'none';
            }
        });

        // Ẩn liên kết Nộp Bài khi thay đổi kích thước màn hình
        window.addEventListener('resize', () => {
            if (window.innerWidth <= 1024) {
                document.querySelector('.navbar a[href="#submit"]').style.display = 'none';
            } else {
                document.querySelector('.navbar a[href="#submit"]').style.display = 'inline-flex';
            }
        });

        // Tải dữ liệu thành viên từ users.json
        async function loadUsersData() {
            try {
                const response = await fetch('data/users.json');
                if (!response.ok) throw new Error('Failed to load users.json');
                const users = await response.json();
                populateSubjectsTable(users); // Hiển thị dữ liệu vào bảng
            } catch (error) {
                console.error('Error loading users data:', error);
                document.getElementById('subjectsTable').innerHTML = '<tr><td colspan="6">Không thể tải dữ liệu thành viên.</td></tr>';
            }
        }

        // Tải dữ liệu lịch học từ calendar.json
        async function loadCalendarData() {
            try {
                const response = await fetch('data/calendar.json');
                if (!response.ok) throw new Error('Failed to load calendar.json');
                const calendarData = await response.json();
                renderCalendar(calendarData); // Hiển thị lịch học
            } catch (error) {
                console.error('Error loading calendar data:', error);
                document.getElementById('calendarGrid').innerHTML = '<div class="col-span-7 text-center">Không thể tải lịch học.</div>';
            }
        }

        // Tính toán xếp hạng thành viên dựa trên tổng điểm
        function getMembershipRank(totalScore) {
            if (totalScore < 50) return '<i class="fas fa-user rank-icon rank-thanhvien"></i>'; // Thành viên
            if (totalScore < 100) return '<i class="fas fa-star rank-icon rank-vip"></i>'; // VIP
            if (totalScore < 201) return '<i class="fas fa-medal rank-icon rank-silver"></i>'; // Silver
            if (totalScore < 301) return '<i class="fas fa-medal rank-icon rank-gold"></i>'; // Gold
            if (totalScore < 501) return '<i class="fas fa-gem rank-icon rank-diamond"></i>'; // Diamond
            return '<i class="fas fa-crown rank-icon rank-vvip"></i>'; // VVIP
        }

        // Hiển thị bảng kết quả học tập
        function populateSubjectsTable(users) {
            const subjectsTable = document.getElementById('subjectsTable');
            subjectsTable.innerHTML = '';
            users.members.forEach(member => {
                const totalScore = member.subjects.reduce((sum, subject) => sum + subject.score, 0);
                const rank = getMembershipRank(totalScore);
                member.subjects.forEach(subject => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${member.fullName}</td>
                        <td>${rank}</td>
                        <td>${subject.name}</td>
                        <td>${subject.duration}</td>
                        <td>${subject.completion}%</td>
                        <td>${subject.score}</td>
                    `;
                    subjectsTable.appendChild(row);
                });
            });
        }

        // Hiển thị lịch học theo tháng
        let currentDate = new Date();
        function renderCalendar(calendarData) {
            const calendarGrid = document.getElementById('calendarGrid');
            const monthYear = document.getElementById('monthYear');
            calendarGrid.innerHTML = '';

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            monthYear.textContent = `${month + 1}-${year}`; // Hiển thị tháng và năm

            const days = ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'];
            days.forEach(day => {
                const div = document.createElement('div');
                div.textContent = day;
                div.classList.add('header');
                calendarGrid.appendChild(div);
            });

            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) {
                calendarGrid.appendChild(document.createElement('div')); // Ô trống trước ngày 1
            }

            for (let date = 1; date <= lastDate; date++) {
                const div = document.createElement('div');
                div.textContent = date;
                const event = calendarData.find(e => {
                    const eventDate = new Date(e.date);
                    return eventDate.getDate() === date && eventDate.getMonth() === month && eventDate.getFullYear() === year;
                });
                if (event) {
                    div.classList.add('has-event');
                    div.addEventListener('click', () => {
                        document.getElementById('eventDetails').innerHTML = `
                            <p><strong>Môn:</strong> ${event.subject}</p>
                            <p><strong>Thời gian:</strong> Từ ${event.startTime} đến ${event.endTime}</p>
                            <p><strong>Buổi:</strong> ${event.session}</p>
                        `;
                    });
                    // Xử lý chạm lâu trên Android
                    div.addEventListener('touchstart', function(e) {
                        if (document.body.classList.contains('android')) {
                            setTimeout(() => {
                                if (div.classList.contains('has-event')) {
                                    div.click();
                                }
                            }, 500);
                        }
                    });
                }
                calendarGrid.appendChild(div);
            }
        }

        // Chuyển tháng trước
        function prevMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            loadCalendarData();
        }

        // Chuyển tháng sau
        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            loadCalendarData();
        }

        // Xử lý gửi form nộp bài
        document.getElementById('codeForm').addEventListener('submit', (e) => {
            const fileInput = document.getElementById('submissionFile');
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                if (file.size > 100 * 1024 * 1024) { // Kiểm tra file > 100MB
                    e.preventDefault();
                    alert('File quá lớn! Vui lòng chọn file dưới 100MB.');
                    return;
                }
            }
            document.getElementById('submissionTime').value = new Date().toLocaleString('vi-VN'); // Ghi thời gian nộp bài
        });

        // Xử lý gửi form phản hồi
        document.getElementById('feedbackForm').addEventListener('submit', () => {
            document.getElementById('feedbackSubmissionTime').value = new Date().toLocaleString('vi-VN'); // Ghi thời gian phản hồi
        });

        // Logic game
        let gameRunning = false;
        let score = 0;
        let frameCount = 0;

        if (isIOS) {
            // Game T-Rex cho iOS
            let dino = { x: 50, y: 120, width: 30, height: 30, dy: 0, gravity: 0.6, jumpPower: -10, grounded: true }; // Thông số khủng long
            let obstacles = []; // Danh sách chướng ngại vật

            function drawDino() {
                ctx.fillStyle = 'white';
                ctx.fillRect(dino.x, dino.y, dino.width, dino.height); // Vẽ khủng long
            }

            function drawObstacles() {
                ctx.fillStyle = 'green';
                obstacles.forEach(obstacle => {
                    ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height); // Vẽ chướng ngại vật
                });
            }

            function spawnObstacle() {
                const obstacle = { x: canvas.width, y: 120, width: 15, height: 30, speed: 4 }; // Tạo chướng ngại vật mới
                obstacles.push(obstacle);
            }

            function updateGame() {
                if (!gameRunning) return;

                ctx.clearRect(0, 0, canvas.width, canvas.height); // Xóa canvas

                // Cập nhật khủng long
                dino.dy += dino.gravity;
                dino.y += dino.dy;
                if (dino.y > 120) {
                    dino.y = 120;
                    dino.dy = 0;
                    dino.grounded = true;
                }
                drawDino();

                // Cập nhật chướng ngại vật
                if (frameCount % 60 === 0) {
                    spawnObstacle();
                }
                obstacles.forEach(obstacle => {
                    obstacle.x -= obstacle.speed;
                });
                obstacles = obstacles.filter(obstacle => obstacle.x + obstacle.width > 0);
                drawObstacles();

                // Phát hiện va chạm
                for (let obstacle of obstacles) {
                    if (
                        dino.x < obstacle.x + obstacle.width &&
                        dino.x + dino.width > obstacle.x &&
                        dino.y < obstacle.y + obstacle.height &&
                        dino.y + dino.height > obstacle.y
                    ) {
                        gameRunning = false;
                        alert(`Game Over! Điểm: ${score}`);
                        return;
                    }
                }

                // Cập nhật điểm số
                score = Math.floor(frameCount / 10);
                document.getElementById('scoreDisplay').textContent = `Điểm: ${score}`;
                frameCount++;

                requestAnimationFrame(updateGame); // Tiếp tục vòng lặp game
            }

            function startGame() {
                gameRunning = true;
                score = 0;
                frameCount = 0;
                dino.y = 120;
                dino.dy = 0;
                dino.grounded = true;
                obstacles = [];
                document.getElementById('scoreDisplay').textContent = `Điểm: ${score}`;
                updateGame(); // Bắt đầu game
            }

            // Xử lý input cho T-Rex
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space' && dino.grounded && gameRunning) {
                    dino.dy = dino.jumpPower;
                    dino.grounded = false; // Nhảy khi nhấn Space
                }
            });

            canvas.addEventListener('touchstart', () => {
                if (dino.grounded && gameRunning) {
                    dino.dy = dino.jumpPower;
                    dino.grounded = false; // Nhảy khi chạm màn hình
                }
            });
        } else if (isAndroid) {
            // Game Blast Block cho Android
            let blocks = [];
            const blockSize = 30; // Kích thước khối
            const rows = Math.floor(canvas.height / blockSize);
            const cols = Math.floor(canvas.width / blockSize);

            function createBlocks() {
                blocks = [];
                for (let row = 0; row < rows; row++) {
                    for (let col = 0; col < cols; col++) {
                        if (Math.random() > 0.3) {
                            blocks.push({
                                x: col * blockSize,
                                y: row * blockSize,
                                width: blockSize,
                                height: blockSize,
                                color: `hsl(${Math.random() * 360}, 70%, 50%)` // Màu ngẫu nhiên
                            });
                        }
                    }
                }
            }

            function drawBlocks() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                blocks.forEach(block => {
                    ctx.fillStyle = block.color;
                    ctx.fillRect(block.x, block.y, block.width - 2, block.height - 2); // Vẽ các khối
                });
            }

            function updateGame() {
                if (!gameRunning) return;

                drawBlocks();

                // Cập nhật điểm số
                document.getElementById('scoreDisplay').textContent = `Điểm: ${score}`;
                frameCount++;

                requestAnimationFrame(updateGame); // Tiếp tục vòng lặp game
            }

            function startGame() {
                gameRunning = true;
                score = 0;
                frameCount = 0;
                createBlocks();
                document.getElementById('scoreDisplay').textContent = `Điểm: ${score}`;
                updateGame(); // Bắt đầu game
            }

            // Xử lý input cho Blast Block
            canvas.addEventListener('touchstart', (e) => {
                if (!gameRunning) return;
                const rect = canvas.getBoundingClientRect();
                const touchX = e.touches[0].clientX - rect.left;
                const touchY = e.touches[0].clientY - rect.top;

                blocks = blocks.filter(block => {
                    if (
                        touchX >= block.x &&
                        touchX <= block.x + block.width &&
                        touchY >= block.y &&
                        touchY <= block.y + block.height
                    ) {
                        score += 10;
                        return false; // Xóa khối khi chạm
                    }
                    return true;
                });

                if (blocks.length === 0) {
                    gameRunning = false;
                    alert(`Chúc mừng! Bạn đã phá hết khối! Điểm: ${score}`);
                }
            });

            document.addEventListener('click', (e) => {
                if (!gameRunning) return;
                const rect = canvas.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const clickY = e.clientY - rect.top;

                blocks = blocks.filter(block => {
                    if (
                        clickX >= block.x &&
                        clickX <= block.x + block.width &&
                        clickY >= block.y &&
                        clickY <= block.y + block.height
                    ) {
                        score += 10;
                        return false; // Xóa khối khi click
                    }
                    return true;
                });

                if (blocks.length === 0) {
                    gameRunning = false;
                    alert(`Chúc mừng! Bạn đã phá hết khối! Điểm: ${score}`);
                }
            });
        }

        // Điều hướng giữa các section
        const sections = ['home', 'calendar', 'submit', 'game', 'feedback'];
        function showSection(sectionId) {
            sections.forEach(id => {
                document.getElementById(id).classList.add('hidden'); // Ẩn tất cả section
            });
            document.getElementById(sectionId).classList.remove('hidden'); // Hiển thị section được chọn
            document.querySelectorAll('.navbar a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href').substring(1) === sectionId) {
                    link.classList.add('active'); // Đánh dấu liên kết đang hoạt động
                }
            });
        }

        // Xử lý sự kiện click trên navbar
        document.querySelectorAll('.navbar a').forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                const sectionId = link.getAttribute('href').substring(1);
                showSection(sectionId);
            });
        });

        // Khởi tạo trang
        document.addEventListener('DOMContentLoaded', () => {
            loadUsersData(); // Tải dữ liệu thành viên
            loadCalendarData(); // Tải dữ liệu lịch học
            showSection('home'); // Hiển thị section Trang Chủ mặc định
        });
    </script>
</body>
</html>
