<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Cổng Học Viên Lập Trình & Điểm Thành Viên - Xứ Đoàn Các Thánh Tử Đạo Việt Nam - Giáo Xứ Chánh Tòa Mỹ Tho">
    <meta name="keywords" content="Xứ Đoàn, Giáo Xứ Chánh Tòa Mỹ Tho, Các Thánh Tử Đạo Việt Nam, học lập trình, điểm thành viên, đổi quà">
    <title>Cổng Học Viên & Điểm Thành Viên - Xứ Đoàn Các Thánh Tử Đạo Việt Nam</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #cc3048;
            --primary-dark: #b7142a;
            --accent: #FFD700;
            --dark-bg: #1A1A1A;
            --text: #E0E0E0;
            --error: #EF4444;
        }

        body {
            background: linear-gradient(135deg, #2D2D2D 0%, #1A1A1A 100%);
            font-family: 'Roboto', sans-serif;
            margin: 0;
            color: var(--text);
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        body.ios {
            font-family: -apple-system, 'SF Pro', 'Roboto', sans-serif;
        }

        .header {
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--text);
            padding: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
            text-align: center;
        }
        .header h2 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.2rem;
        }
        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .navbar {
            background: var(--dark-bg);
            padding: 0.5rem;
            display: flex;
            justify-content: space-around;
            position: fixed;
            bottom: 0;
            width: 100%;
            box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }
        .navbar a {
            color: var(--text);
            padding: 0.4rem;
            font-size: 0.75rem;
            text-align: center;
            border-radius: 6px;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }
        .navbar a i {
            font-size: 1rem;
            margin-bottom: 0.2rem;
        }
        .navbar a:hover {
            background: var(--primary);
            color: var(--accent);
            transform: scale(1.1);
        }
        .navbar a.active {
            background: var(--primary);
            color: var(--accent);
        }

        .menu-panel {
            position: fixed;
            top: 0;
            right: -100%;
            width: 75%;
            height: 100%;
            background: #252526;
            box-shadow: -4px 0 12px rgba(0, 0, 0, 0.3);
            z-index: 1002;
            padding: 1rem;
            transition: transform 0.3s ease;
            overflow-y: auto;
        }
        .menu-panel.active {
            transform: translateX(-100%);
        }
        .menu-panel a {
            display: block;
            padding: 0.75rem;
            font-size: 1rem;
            color: var(--text);
            border-bottom: 1px solid #3C3C3C;
            transition: all 0.2s ease;
        }
        .menu-panel a:hover {
            background: var(--primary);
            color: var(--accent);
        }
        .menu-panel a.active {
            background: var(--primary);
            color: var(--accent);
        }

        .container {
            flex: 1;
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 1rem;
            overflow-y: auto;
            height: calc(100vh - 60px - 60px);
        }

        .card {
            background: #252526;
            border: 1px solid #3C3C3C;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
            display: none;
            height: 100%;
            overflow-y: auto;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .card.active {
            display: block;
            animation: flipIn 0.6s ease forwards;
        }
        @keyframes flipIn {
            from { opacity: 0; transform: rotateY(90deg); }
            to { opacity: 1; transform: rotateY(0); }
        }
        .card h3 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            color: var(--accent);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .prayer-widget {
            background: var(--primary);
            color: var(--text);
            padding: 0.8rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            text-align: center;
            font-style: italic;
            font-size: 0.9rem;
        }

        .member-card {
            background: #1E1E1E;
            border: 1px solid #3C3C3C;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .member-card h4 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            color: var(--accent);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .progress-item {
            margin-bottom: 1rem;
        }
        .progress-item p {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        .progress-bar {
            background: #1E1E1E;
            border-radius: 8px;
            overflow: hidden;
            height: 20px;
        }
        .progress-fill {
            background: var(--primary);
            height: 100%;
            transition: width 0.5s ease;
        }

        .rank-widget {
            background: #252526;
            border: 1px solid #3C3C3C;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .rank-widget h4 {
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent);
            margin-bottom: 1rem;
        }
        .rank-list li {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            font-size: 0.9rem;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            background: #252526;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .calendar .header {
            background: var(--primary);
            color: var(--text);
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        .calendar div {
            padding: 0.5rem;
            text-align: center;
            border: 1px solid #3C3C3C;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        .calendar .has-event {
            background: var(--accent);
            color: #1A1A1A;
            font-weight: bold;
        }
        .calendar div:hover {
            background: #3C3C3C;
        }
        .calendar div a {
            font-size: 0.8rem;
            color: #60A5FA;
            display: block;
            margin-top: 2px;
        }

        #eventPopup, #detailsPopup {
            position: fixed;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(26, 26, 26, 0.95);
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            width: 300px;
            font-size: 0.9rem;
            z-index: 1001;
            display: none;
            text-align: left;
        }

        .details-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .details-list p {
            margin: 0;
            font-size: 0.9rem;
            display: flex;
            flex-direction: column;
        }
        .details-list p strong {
            color: var(--accent);
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: 0.2rem;
        }
        .details-list p span {
            color: var(--text);
            word-break: break-word;
        }

        .guide-section {
            background: #1E1E1E;
            border: 1px solid #3C3C3C;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .guide-section summary {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            color: var(--accent);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .guide-section summary i {
            color: var(--primary);
        }
        .guide-section p, .guide-section ul {
            font-size: 0.9rem;
            color: var(--text);
            margin-top: 0.5rem;
        }
        .guide-section ul {
            list-style-type: disc;
            padding-left: 1.5rem;
        }
        .guide-section ul ul {
            list-style-type: circle;
            padding-left: 1.5rem;
        }

        .gift-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .gift-item {
            background: #1E1E1E;
            border: 1px solid #3C3C3C;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            transition: transform 0.2s ease;
        }
        .gift-item:hover {
            transform: scale(1.05);
        }
        .gift-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 0.5rem;
        }
        .gift-item p {
            font-size: 0.9rem;
            color: var(--text);
        }

        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(26, 26, 26, 0.95);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            width: 300px;
            font-size: 0.9rem;
            z-index: 1001;
            text-align: center;
            display: none;
        }
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: none;
        }

        .btn {
            background: var(--primary);
            color: var(--text);
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .btn:hover {
            background: var(--primary-dark);
            color: var(--accent);
            transform: translateY(-2px);
        }
        .btn:active {
            transform: translateY(0);
        }

        .input, .textarea, select.input {
            background: #1E1E1E;
            border: 1px solid #3C3C3C;
            border-radius: 8px;
            padding: 0.75rem;
            color: var(--text);
            width: 100%;
            font-family: 'Roboto', sans-serif;
        }
        .textarea {
            resize: vertical;
            min-height: 150px;
            font-size: 0.9rem;
        }
        .file-input {
            background: #1E1E1E;
            border: 1px solid #3C3C3C;
            border-radius: 8px;
            padding: 0.75rem;
            color: var(--text);
            width: 100%;
            font-family: 'Roboto', sans-serif;
        }

        @media (max-width: 1024px) {
            :root {
                --primary: #e63950;
                --accent: #FFD54F;
            }
            body {
                overflow-y: hidden;
            }
            .header {
                padding: 0.5rem;
            }
            .header h2 {
                font-size: 1rem;
            }
            .header p {
                font-size: 0.7rem;
            }
            .navbar {
                padding: 0.3rem;
            }
            .navbar a {
                padding: 0.3rem;
                font-size: 0.75rem;
            }
            .navbar a i {
                font-size: 1rem;
            }
            .container {
                margin: 0 auto;
                padding: 0.5rem;
                height: calc(100vh - 50px - 50px);
            }
            .card {
                padding: 1rem;
                height: 100%;
                overflow-y: auto;
            }
            .card h3 {
                font-size: 1.3rem;
            }
            .member-card h4, .progress-item p, .rank-list li, .guide-section p, .guide-section ul {
                font-size: 0.85rem;
            }
            .calendar div {
                padding: 0.4rem;
                font-size: 0.85rem;
            }
            .gift-item p {
                font-size: 0.85rem;
            }
            .btn {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
            #gameCanvas {
                width: 90vw;
                height: 150px;
            }
            body.ios .navbar, body.ios .menu-panel {
                background: rgba(26, 26, 26, 0.95);
                backdrop-filter: blur(10px);
            }
            body.ios .navbar a:active, body.ios .menu-panel a:active {
                transform: scale(0.95);
                box-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
                background: rgba(204, 48, 72, 0.9);
            }
            body.ios .btn:active {
                transform: scale(0.95);
                box-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
            }
            body.ios #eventPopup, body.ios #detailsPopup, body.ios .popup {
                bottom: 20%;
            }
        }

        @media (min-width: 1025px) {
            .navbar a[href="#game"] {
                display: none;
            }
            #game {
                display: none;
            }
            .navbar a:hover {
                background: linear-gradient(45deg, var(--primary), var(--accent));
            }
            .textarea {
                min-height: 200px;
                font-size: 1rem;
            }
            .container {
                height: calc(100vh - 80px - 60px);
            }
            .navbar a[href="#more"] {
                display: none;
            }
            .member-card h4, .details-list p, .progress-item p, .rank-list li, .guide-section p, .guide-section ul {
                font-size: 1rem;
            }
            #detailsPopup, .popup {
                max-width: 400px;
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="popup-overlay" id="successOverlay">
        <div class="popup" id="successPopup">
            <p>Yêu cầu đổi quà đang được xem xét, sẽ có thông báo tại Gmail của bạn.</p>
            <button class="btn mt-4" onclick="closeSuccessPopup()">Thoát</button>
        </div>
    </div>

    <div class="menu-panel" id="menuPanel">
        <a href="#back"><i class="fas fa-arrow-left"></i> Trở Lại</a>
        <a href="#submit"><i class="fas fa-upload"></i> Nộp Bài</a>
        <a href="#game"><i class="fas fa-gamepad"></i> Giải Trí</a>
        <a href="#feedback"><i class="fas fa-comment"></i> Phản Hồi</a>
        <a href="#details"><i class="fas fa-info-circle"></i> Chi Tiết</a>
        <a href="#guide"><i class="fas fa-question-circle"></i> Hướng Dẫn</a>
        <a href="#lookup"><i class="fas fa-search"></i> Tra Cứu Điểm</a>
        <a href="#redeem"><i class="fas fa-gift"></i> Đổi Quà</a>
    </div>

    <div class="header">
        <h2>XỨ ĐOÀN CÁC THÁNH TỬ ĐẠO VIỆT NAM</h2>
        <p>Cổng Học Viên Lập Trình & Điểm Thành Viên - Giáo Xứ Chánh Tòa Mỹ Tho</p>
    </div>

    <div class="navbar" id="navbar">
        <a href="#home" class="main-menu active"><i class="fas fa-home"></i><span>Trang Chủ</span></a>
        <a href="#calendar" class="main-menu"><i class="fas fa-calendar"></i><span>Lịch Học</span></a>
        <a href="#resources" class="main-menu"><i class="fas fa-book"></i><span>Tài Liệu</span></a>
        <a href="#more" class="main-menu"><i class="fas fa-window-maximize"></i><span>Xem Thêm</span></a>
        <a href="#submit" class="desktop-menu"><i class="fas fa-upload"></i><span>Nộp Bài</span></a>
        <a href="#feedback" class="desktop-menu"><i class="fas fa-comment"></i><span>Phản Hồi</span></a>
        <a href="#details" class="desktop-menu"><i class="fas fa-info-circle"></i><span>Chi Tiết</span></a>
        <a href="#guide" class="desktop-menu"><i class="fas fa-question-circle"></i><span>Hướng Dẫn</span></a>
        <a href="#lookup" class="desktop-menu"><i class="fas fa-search"></i><span>Tra Cứu Điểm</span></a>
        <a href="#redeem" class="desktop-menu"><i class="fas fa-gift"></i><span>Đổi Quà</span></a>
    </div>

    <div class="container">
        <div id="home" class="card active">
            <div class="prayer-widget">
                <p id="dailyPrayer">“Kẻ nào bền chí đến cùng, kẻ ấy sẽ được cứu độ.” (Mt 24:13)</p>
            </div>
            <div class="rank-widget">
                <h4>Bảng Xếp Hạng Động Lực</h4>
                <ul class="rank-list" id="rankList"></ul>
            </div>
            <h3>Kết Quả Học Tập</h3>
            <div class="progress-container" id="subjectsProgress"></div>
        </div>

        <div id="calendar" class="card">
            <h3>Lịch Học</h3>
            <div class="mb-4">
                <input type="text" id="calendarSearch" class="input" placeholder="Tìm môn học hoặc buổi...">
            </div>
            <div id="searchResults" class="mb-4"></div>
            <div class="flex justify-between mb-4">
                <button class="btn" onclick="prevMonth()">◄</button>
                <h4 id="monthYear" class="font-bold text-accent"></h4>
                <button class="btn" onclick="nextMonth()">►</button>
            </div>
            <div class="calendar" id="calendarGrid"></div>
            <button class="btn mt-4" onclick="downloadCalendar()">Tải Lịch Học (.ics)</button>
            <div id="eventPopup"></div>
        </div>

        <div id="submit" class="card">
            <h3>Nộp Bài</h3>
            <form id="codeForm" action="https://formsubmit.co/notification2411.huynhdutruong@gmail.com" method="POST" enctype="multipart/form-data">
                <div class="mb-4">
                    <label class="block mb-1 text-text">Họ và Tên:</label>
                    <input type="text" name="fullName" id="codeFullName" class="input" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text">Ngôn Ngữ:</label>
                    <select name="language" class="input" required>
                        <option value="python">Python</option>
                        <option value="javascript">JavaScript</option>
                        <option value="html_css">HTML/CSS</option>
                        <option value="other">Khác</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text">Mã Nguồn:</label>
                    <textarea name="codeContent" class="textarea" placeholder="Dán mã nguồn..."></textarea>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text">Link Bài Nộp:</label>
                    <input type="url" name="submissionLink" class="input" placeholder="https://...">
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text">File Báo Cáo:</label>
                    <input type="file" name="submissionFile" id="submissionFile" class="file-input" accept=".pdf,.zip,.txt,.doc,.docx">
                </div>
                <input type="hidden" name="submissionTime" id="submissionTime">
                <button type="submit" class="btn">Gửi Bài</button>
            </form>
        </div>

        <div id="game" class="card">
            <h3>Game</h3>
            <canvas id="gameCanvas"></canvas>
            <div class="mt-4 text-center">
                <p id="gameInstructions"></p>
                <p id="scoreDisplay">Điểm: 0</p>
                <p id="highScoreDisplay">Điểm cao: <span id="highScore">0</span></p>
                <button class="btn" onclick="startGame()">Bắt Đầu Lại</button>
            </div>
        </div>

        <div id="feedback" class="card">
            <h3>Phản Hồi</h3>
            <div id="feedbackContent"></div>
        </div>

        <div id="resources" class="card">
            <h3>Tài Liệu</h3>
            <div id="resourcesList"></div>
        </div>

        <div id="details" class="card">
            <h3>Thông Tin Chi Tiết</h3>
            <div class="details-list" id="detailsContent"></div>
            <div id="detailsPopup" class="details-list"></div>
        </div>

        <div id="guide" class="card">
            <h3>Hướng Dẫn Điểm Thành Viên</h3>
            <div id="guideContent">
                <p class="mb-4">Chào mừng bạn đến với <strong>Hệ thống Điểm Thành Viên</strong> của Xứ Đoàn Các Thánh Tử Đạo Việt Nam - Giáo Xứ Chánh Tòa Mỹ Tho! Hệ thống này được thiết kế để khuyến khích học viên tham gia học tập, hoạt động ngoại khóa và đóng góp tích cực, với cơ hội đổi những phần quà hấp dẫn.</p>
                
                <details class="guide-section" open>
                    <summary><i class="fas fa-star"></i> Cách Tính Điểm Thành Viên</summary>
                    <p>Điểm thành viên được tính dựa trên các hoạt động sau:</p>
                    <ul class="list-disc pl-5 mb-4">
                        <li><strong>Chi tiêu:</strong> Cứ 1000đ chi tiêu (ví dụ: đóng học phí, mua tài liệu) = 1 điểm.</li>
                        <li><strong>Tham gia lớp học:</strong> Mỗi buổi học hoàn thành = 1 điểm.</li>
                        <li><strong>Thành quả học tập:</strong>
                            <ul class="list-circle pl-5">
                                <li>Đạt trên 60% điểm môn học = 2 điểm.</li>
                                <li>Đạt trên 80% điểm môn học = 3 điểm.</li>
                                <li>Đạt trên 95% điểm môn học = 5 điểm.</li>
                            </ul>
                        </li>
                        <li><strong>Hoạt động ngoại khóa:</strong> Mỗi lần tham gia = 2 điểm.</li>
                    </ul>
                    <p><strong>Ví dụ:</strong> Bạn Nguyễn Văn A chi tiêu 5000đ (5 điểm), tham gia 10 buổi học (10 điểm), đạt 85% môn Python (3 điểm), và tham gia 3 hoạt động ngoại khóa (6 điểm). Tổng điểm: 5 + 10 + 3 + 6 = 24 điểm.</p>
                </details>

                <details class="guide-section">
                    <summary><i class="fas fa-gift"></i> Lợi Ích của Điểm Thành Viên</summary>
                    <p>Điểm thành viên mang lại các lợi ích sau:</p>
                    <ul class="list-disc pl-5 mb-4">
                        <li><strong>Đổi quà:</strong> Sử dụng điểm để đổi các phần quà hấp dẫn như sổ tay, áo thun, hoặc bình nước.</li>
                        <li><strong>Xếp hạng động lực:</strong> Điểm cao giúp bạn lọt vào Bảng Xếp Hạng Động Lực, được vinh danh trên cổng học viên.</li>
                        <li><strong>Khuyến khích học tập:</strong> Điểm phản ánh nỗ lực học tập và đóng góp, giúp bạn theo dõi tiến độ cá nhân.</li>
                    </ul>
                </details>

                <details class="guide-section">
                    <summary><i class="fas fa-question"></i> Câu Hỏi Thường Gặp</summary>
                    <ul class="list-disc pl-5 mb-4">
                        <li><strong>Điểm được cập nhật bao lâu một lần?</strong> Điểm được cập nhật hàng tuần dựa trên dữ liệu từ ban quản lý.</li>
                        <li><strong>Tôi có thể tra cứu điểm ở đâu?</strong> Sử dụng mục "Tra Cứu Điểm" trong cổng này, nhập Họ và Tên Thánh cùng Lớp.</li>
                        <li><strong>Quà đổi có giới hạn không?</strong> Một số quà có số lượng giới hạn, vui lòng kiểm tra mục "Đổi Quà".</li>
                        <li><strong>Liên hệ hỗ trợ?</strong> Gửi phản hồi qua mục "Phản Hồi" hoặc email notification2411.huynhdutruong@gmail.com.</li>
                    </ul>
                </details>
            </div>
        </div>

        <div id="lookup" class="card">
            <h3>Tra Cứu Điểm</h3>
            <form id="lookupForm">
                <div class="mb-4">
                    <label class="block mb-1 text-text">Họ và Tên Thánh:</label>
                    <input type="text" id="lookupName" class="input" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text">Lớp:</label>
                    <select id="lookupSubject" class="input" required></select>
                </div>
                <button type="submit" class="btn">Tra Cứu</button>
            </form>
            <div id="lookupResult" class="mt-4"></div>
        </div>

        <div id="redeem" class="card">
            <h3>Đổi Quà</h3>
            <div class="gift-grid" id="giftList"></div>
            <form id="redeemForm" action="https://formsubmit.co/notification2411.huynhdutruong@gmail.com" method="POST">
                <div class="mb-4">
                    <label class="block mb-1 text-text">Họ và Tên Thánh:</label>
                    <input type="text" name="fullName" id="redeemName" class="input" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text">Gmail:</label>
                    <input type="email" name="gmail" id="redeemGmail" class="input" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text">Lớp:</label>
                    <select name="subject" id="redeemSubject" class="input" required></select>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text">Số Điểm Hiện Tại:</label>
                    <input type="text" id="redeemPoints" name="points" class="input" readonly>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text">Mã Quà:</label>
                    <input type="text" name="giftCode" id="giftCode" class="input" required>
                </div>
                <input type="hidden" name="submissionTime" id="redeemSubmissionTime">
                <button type="submit" class="btn">Đổi Quà</button>
            </form>
        </div>
    </div>

    <script>
        const isMobile = window.innerWidth <= 1024;
        const isIOS = /iPhone|iPad/.test(navigator.userAgent);
        const isAndroid = /Android/.test(navigator.userAgent);

        // Feedback content
        if (isMobile) {
            document.getElementById('feedbackContent').innerHTML = `
                <p>Nhấn vào nút dưới để gửi phản hồi qua Messenger:</p>
                <a href="https://m.me/tnttchanhtoamytho" target="_blank" class="btn">Gửi Phản Hồi</a>
            `;
        } else {
            document.getElementById('feedbackContent').innerHTML = `
                <form id="feedbackForm" action="https://formsubmit.co/notification2411.huynhdutruong@gmail.com" method="POST">
                    <div class="mb-4">
                        <label class="block mb-1 text-text">Họ và Tên:</label>
                        <input type="text" name="fullName" id="feedbackFullName" class="input" required>
                    </div>
                    <div class="mb-4">
                        <label class="block mb-1 text-text">Gmail:</label>
                        <input type="email" name="gmail" class="input" required>
                    </div>
                    <div class="mb-4">
                        <label class="block mb-1 text-text">Nội Dung (Tối đa 250 chữ):</label>
                        <textarea name="content" class="textarea" maxlength="250" required></textarea>
                    </div>
                    <input type="hidden" name="submissionTime" id="feedbackSubmissionTime">
                    <button type="submit" class="btn">Gửi Phản Hồi</button>
                </form>
            `;
        }

        // Game instructions
        if (isIOS && isMobile) {
            document.getElementById('gameInstructions').textContent = 'Chạm màn hình để nhảy!';
        } else if (isAndroid && isMobile) {
            document.getElementById('gameInstructions').textContent = 'Chạm để phá khối!';
        }

        // Resize canvas
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        function resizeCanvas() {
            if (window.innerWidth <= 1024) {
                canvas.width = window.innerWidth * 0.9;
                canvas.height = 150;
            } else {
                canvas.width = 600;
                canvas.height = 200;
            }
        }
        window.addEventListener('resize', () => {
            resizeCanvas();
            updateNavbar();
        });
        resizeCanvas();

        // Update navbar
        function updateNavbar() {
            const mainMenu = document.querySelectorAll('.main-menu');
            const desktopMenu = document.querySelectorAll('.desktop-menu');
            if (window.innerWidth <= 1024) {
                mainMenu.forEach(link => link.style.display = 'flex');
                desktopMenu.forEach(link => link.style.display = 'none');
            } else {
                mainMenu.forEach(link => link.style.display = 'flex');
                desktopMenu.forEach(link => link.style.display = 'flex');
                document.querySelector('.navbar a[href="#more"]').style.display = 'none';
            }
        }

        // Toggle menu panel
        function toggleMenuPanel(show) {
            const menuPanel = document.getElementById('menuPanel');
            menuPanel.classList.toggle('active', show);
        }

        // Load daily prayer
        async function loadDailyPrayer() {
            try {
                const response = await fetch('data/prayers.json');
                if (!response.ok) throw new Error('Failed to load prayers.json');
                const prayers = await response.json();
                const today = new Date().getDay();
                document.getElementById('dailyPrayer').textContent = prayers[today % prayers.length].text;
            } catch (error) {
                console.error('Error loading prayers:', error);
                document.getElementById('dailyPrayer').textContent = '“Kẻ nào bền chí đến cùng, kẻ ấy sẽ được cứu độ.” (Mt 24:13)';
            }
        }

        // Load users data
        let usersData = [];
        async function loadUsersData() {
            try {
                const response = await fetch('data/users.json');
                if (!response.ok) throw new Error('Failed to load users.json');
                usersData = await response.json();
                populateProgress(usersData);
                populateRankList(usersData);
                populateSubjectOptions();
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('subjectsProgress').innerHTML = '<p>Không thể tải dữ liệu.</p>';
                document.getElementById('lookupResult').innerHTML = '<p>Không thể tải dữ liệu.</p>';
            }
        }

        // Load calendar data
        let calendarData = [];
        async function loadCalendarData() {
            try {
                const response = await fetch('data/calendar.json');
                if (!response.ok) throw new Error('Failed to load calendar.json');
                calendarData = await response.json();
                renderCalendar(calendarData);
            } catch (error) {
                console.error('Error loading calendar:', error);
                document.getElementById('calendarGrid').innerHTML = '<div class="col-span-7 text-center">Không thể tải lịch.</div>';
            }
        }

        // Load resources
        async function loadResources() {
            try {
                const response = await fetch('data/resources.json');
                if (!response.ok) throw new Error('Failed to load resources.json');
                const resources = await response.json();
                const resourcesList = document.getElementById('resourcesList');
                resourcesList.innerHTML = resources.map(res => `
                    <div class="mb-2">
                        <a href="${res.url}" target="_blank" class="btn">${res.name}</a>
                        <p class="text-sm">${res.description}</p>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading resources:', error);
                document.getElementById('resourcesList').innerHTML = '<p>Không thể tải tài liệu.</p>';
            }
        }

        // Load gifts data
        async function loadGifts() {
            try {
                const response = await fetch('data/gifts.json');
                if (!response.ok) throw new Error('Failed to load gifts.json');
                const gifts = await response.json();
                const giftList = document.getElementById('giftList');
                giftList.innerHTML = gifts.map(gift => `
                    <div class="gift-item">
                        <img src="${gift.image}" alt="${gift.name}">
                        <p>${gift.name} (Mã: ${gift.code})</p>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading gifts:', error);
                document.getElementById('giftList').innerHTML = '<p>Không thể tải danh sách quà.</p>';
            }
        }

        // Populate subject options
        function populateSubjectOptions() {
            const subjects = [...new Set(usersData.members.flatMap(member => member.subjects.map(s => s.name)))];
            const lookupSubject = document.getElementById('lookupSubject');
            const redeemSubject = document.getElementById('redeemSubject');
            subjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = subject;
                lookupSubject.appendChild(option.cloneNode(true));
                redeemSubject.appendChild(option);
            });
        }

        // Calendar search
        document.getElementById('calendarSearch')?.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const results = calendarData.filter(event =>
                event.subject.toLowerCase().includes(query) ||
                event.session.toLowerCase().includes(query)
            );
            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = results.length ? results.map(event => `
                <p><strong>${event.date}</strong>: ${event.subject} (${event.session}, ${event.startTime} - ${event.endTime})
                ${event.videoLink ? `<a href="${event.videoLink}" target="_blank" class="text-blue-400">Xem Video</a>` : ''}</p>
            `).join('') : '<p>Không tìm thấy.</p>';
        });

        // Download calendar
        function downloadCalendar() {
            let icsContent = `BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Xứ Đoàn//Lịch Học//VI\n`;
            calendarData.forEach(event => {
                const start = new Date(event.date + ' ' + event.startTime).toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
                const end = new Date(event.date + ' ' + event.endTime).toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
                icsContent += `
BEGIN:VEVENT
DTSTART:${start}
DTEND:${end}
SUMMARY:${event.subject} - ${event.session}
DESCRIPTION:${event.videoLink ? `Video: ${event.videoLink}` : ''}
END:VEVENT\n`;
            });
            icsContent += `END:VCALENDAR`;
            const blob = new Blob([icsContent], { type: 'text/calendar' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'lich_hoc.ics';
            link.click();
        }

        // Membership rank logic
        function getMembershipRank(totalScore) {
            if (totalScore < 50) return '<i class="fas fa-user rank-icon rank-thanhvien"></i> Thành Viên';
            if (totalScore < 100) return '<i class="fas fa-star rank-icon rank-vip"></i> VIP';
            if (totalScore < 201) return '<i class="fas fa-medal rank-icon rank-silver"></i> Bạc';
            if (totalScore < 301) return '<i class="fas fa-medal rank-icon rank-gold"></i> Vàng';
            if (totalScore < 501) return '<i class="fas fa-gem rank-icon rank-diamond"></i> Kim Cương';
            return '<i class="fas fa-crown rank-icon rank-vvip"></i> VVip';
        }

        // Calculate points
        function calculatePoints(member) {
            let points = Math.floor(member.spending / 1000); // 1000đ = 1 point
            points += member.sessions || 0; // 1 session = 1 point
            member.subjects.forEach(subject => {
                if (subject.completion > 95) points += 5;
                else if (subject.completion > 80) points += 3;
                else if (subject.completion > 60) points += 2;
            });
            points += (member.activities || 0) * 2; // 2 points per activity
            return points;
        }

        // Populate progress bars
        function populateProgress(users) {
            const subjectsProgress = document.getElementById('subjectsProgress');
            subjectsProgress.innerHTML = '';
            users.members.forEach(member => {
                const points = calculatePoints(member);
                const div = document.createElement('div');
                div.className = 'member-card';
                div.innerHTML = `
                    <h4>${member.fullName} (Hạng: ${getMembershipRank(points)})</h4>
                    ${member.subjects.map(subject => {
                        const normalizedScore = Math.min(subject.score, 100);
                        return `
                            <div class="progress-item">
                                <p>${subject.name}</p>
                                <p>Thời lượng: ${subject.duration} | Điểm: ${normalizedScore}/100 | Hoàn tất: ${subject.completion}%</p>
                                <div class="progress-bar"><div class="progress-fill" style="width: ${subject.completion}%"></div></div>
                            </div>
                        `;
                    }).join('')}
                `;
                subjectsProgress.appendChild(div);
            });
        }

        // Populate rank list
        function populateRankList(users) {
            const rankList = document.getElementById('rankList');
            const sortedMembers = users.members
                .map(member => ({
                    fullName: member.fullName,
                    points: calculatePoints(member)
                }))
                .sort((a, b) => b.points - a.points)
                .slice(0, 5);
            rankList.innerHTML = sortedMembers.map((member, index) => `
                <li><span>${index + 1}. ${member.fullName}</span><span>${member.points} điểm</span></li>
            `).join('');
        }

        // Render calendar
        let currentDate = new Date();
        function renderCalendar(calendarData) {
            const calendarGrid = document.getElementById('calendarGrid');
            const monthYear = document.getElementById('monthYear');
            calendarGrid.innerHTML = '';

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            monthYear.textContent = `${month + 1}-${year}`;

            const days = ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'];
            days.forEach(day => {
                const div = document.createElement('div');
                div.textContent = day;
                div.classList.add('header');
                calendarGrid.appendChild(div);
            });

            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) {
                calendarGrid.appendChild(document.createElement('div'));
            }

            for (let date = 1; date <= lastDate; date++) {
                const div = document.createElement('div');
                div.textContent = date;
                const event = calendarData.find(e => {
                    const eventDate = new Date(e.date);
                    return eventDate.getDate() === date && eventDate.getMonth() === month && eventDate.getFullYear() === year;
                });
                if (event) {
                    div.classList.add('has-event');
                    if (event.videoLink) {
                        div.innerHTML += `<a href="${event.videoLink}" target="_blank" class="text-blue-400 text-xs">Video</a>`;
                    }
                    const showEvent = () => {
                        document.getElementById('eventPopup').innerHTML = `
                            <p><strong>Môn:</strong> ${event.subject}</p>
                            <p><strong>Thời gian:</strong> ${event.startTime} - ${event.endTime}</p>
                            <p><strong>Buổi:</strong> ${event.session}</p>
                            ${event.videoLink ? `<p><a href="${event.videoLink}" target="_blank" class="text-blue-400">Xem Video</a></p>` : ''}
                        `;
                        document.getElementById('eventPopup').style.display = 'block';
                    };
                    div.addEventListener('click', showEvent);
                    let touchTimeout;
                    div.addEventListener('touchstart', () => {
                        touchTimeout = setTimeout(showEvent, 500);
                    });
                    div.addEventListener('touchend', () => {
                        clearTimeout(touchTimeout);
                        document.getElementById('eventPopup').style.display = 'none';
                    });
                    div.addEventListener('touchcancel', () => {
                        clearTimeout(touchTimeout);
                        document.getElementById('eventPopup').style.display = 'none';
                    });
                }
                calendarGrid.appendChild(div);
            }
        }

        function prevMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar(calendarData);
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar(calendarData);
        }

        // Lookup form submission
        document.getElementById('lookupForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('lookupName').value.trim();
            const subject = document.getElementById('lookupSubject').value;
            const member = usersData.members.find(m => m.fullName.toLowerCase() === name.toLowerCase() && m.subjects.some(s => s.name === subject));
            const resultDiv = document.getElementById('lookupResult');
            if (member) {
                const points = calculatePoints(member);
                resultDiv.innerHTML = `
                    <p><strong>Họ và Tên:</strong> ${member.fullName}</p>
                    <p><strong>Số Điểm:</strong> ${points}</p>
                `;
            } else {
                resultDiv.innerHTML = '<p>Không tìm thấy học viên hoặc môn học.</p>';
            }
        });

        // Redeem form points update
        function updateRedeemPoints() {
            const name = document.getElementById('redeemName').value.trim();
            const subject = document.getElementById('redeemSubject').value;
            const pointsField = document.getElementById('redeemPoints');
            const member = usersData.members.find(m => m.fullName.toLowerCase() === name.toLowerCase() && m.subjects.some(s => s.name === subject));
            if (member) {
                const points = calculatePoints(member);
                pointsField.value = points;
            } else {
                pointsField.value = '';
            }
        }

        document.getElementById('redeemName').addEventListener('input', updateRedeemPoints);
        document.getElementById('redeemSubject').addEventListener('change', updateRedeemPoints);

        // Redeem form submission
        document.getElementById('redeemForm').addEventListener('submit', (e) => {
            document.getElementById('redeemSubmissionTime').value = new Date().toLocaleString('vi-VN');
            setTimeout(() => {
                document.getElementById('successOverlay').style.display = 'block';
                document.getElementById('successPopup').style.display = 'block';
            }, 500); // Delay to simulate form submission
        });

        // Close success popup
        function closeSuccessPopup() {
            document.getElementById('successOverlay').style.display = 'none';
            document.getElementById('successPopup').style.display = 'none';
            document.getElementById('redeemForm').reset();
            document.getElementById('redeemPoints').value = '';
        }

        // Form submission
        document.getElementById('codeForm').addEventListener('submit', (e) => {
            const fileInput = document.getElementById('submissionFile');
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                if (file.size > 100 * 1024 * 1024) {
                    e.preventDefault();
                    alert('File quá lớn! Vui lòng chọn file dưới 100MB.');
                    return;
                }
            }
            document.getElementById('submissionTime').value = new Date().toLocaleString('vi-VN');
        });

        if (!isMobile) {
            document.getElementById('feedbackForm')?.addEventListener('submit', () => {
                document.getElementById('feedbackSubmissionTime').value = new Date().toLocaleString('vi-VN');
            });
        }

        // Game logic
        let gameRunning = false;
        let score = 0;
        let frameCount = 0;

        function updateHighScore() {
            const highScore = localStorage.getItem('highScore') || 0;
            if (score > highScore) {
                localStorage.setItem('highScore', score);
                document.getElementById('highScore').textContent = score;
            }
        }

        if (isMobile) {
            if (isIOS) {
                let dino = { x: 50, y: canvas.height - 30, width: 30, height: 30, dy: 0, gravity: 0.8, jumpPower: -12, grounded: true };
                let obstacles = [];

                function drawDino() {
                    ctx.fillStyle = 'white';
                    ctx.fillRect(dino.x, dino.y, dino.width, dino.height);
                }

                function drawObstacles() {
                    ctx.fillStyle = 'green';
                    obstacles.forEach(obstacle => {
                        ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                    });
                }

                function spawnObstacle() {
                    const obstacle = { x: canvas.width, y: canvas.height - 30, width: 20, height: 30, speed: 5 };
                    obstacles.push(obstacle);
                }

                function updateGame() {
                    if (!gameRunning) return;

                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    dino.dy += dino.gravity;
                    dino.y += dino.dy;
                    if (dino.y > canvas.height - dino.height) {
                        dino.y = canvas.height - dino.height;
                        dino.dy = 0;
                        dino.grounded = true;
                    }
                    drawDino();

                    if (frameCount % 60 === 0) {
                        spawnObstacle();
                    }
                    obstacles.forEach(obstacle => {
                        obstacle.x -= obstacle.speed;
                    });
                    obstacles = obstacles.filter(obstacle => obstacle.x + obstacle.width > 0);
                    drawObstacles();

                    for (let obstacle of obstacles) {
                        if (
                            dino.x < obstacle.x + obstacle.width &&
                            dino.x + dino.width > obstacle.x &&
                            dino.y < obstacle.y + obstacle.height &&
                            dino.y + dino.height > obstacle.y
                        ) {
                            gameRunning = false;
                            updateHighScore();
                            alert(`Game Over! Điểm: ${score}, Điểm cao: ${localStorage.getItem('highScore') || 0}`);
                            return;
                        }
                    }

                    score = Math.floor(frameCount / 10);
                    document.getElementById('scoreDisplay').textContent = `Điểm: ${score}`;
                    frameCount++;

                    requestAnimationFrame(updateGame);
                }

                function startGame() {
                    gameRunning = true;
                    score = 0;
                    frameCount = 0;
                    dino.y = canvas.height - 30;
                    dino.dy = 0;
                    dino.grounded = true;
                    obstacles = [];
                    document.getElementById('scoreDisplay').textContent = `Điểm: ${score}`;
                    updateGame();
                }

                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space' && dino.grounded && gameRunning) {
                        dino.dy = dino.jumpPower;
                        dino.grounded = false;
                    }
                });

                canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (dino.grounded && gameRunning) {
                        dino.dy = dino.jumpPower;
                        dino.grounded = false;
                    }
                });
            } else if (isAndroid) {
                let blocks = [];
                const blockSize = 30;
                const rows = Math.floor(canvas.height / blockSize);
                const cols = Math.floor(canvas.width / blockSize);

                function createBlocks() {
                    blocks = [];
                    for (let row = 0; row < rows; row++) {
                        for (let col = 0; col < cols; col++) {
                            if (Math.random() > 0.3) {
                                blocks.push({
                                    x: col * blockSize,
                                    y: row * blockSize,
                                    width: blockSize,
                                    height: blockSize,
                                    color: `hsl(${Math.random() * 360}, 70%, 50%)`
                                });
                            }
                        }
                    }
                }

                function drawBlocks() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    blocks.forEach(block => {
                        ctx.fillStyle = block.color;
                        ctx.fillRect(block.x, block.y, block.width - 2, block.height - 2);
                    });
                }

                function updateGame() {
                    if (!gameRunning) return;

                    drawBlocks();

                    document.getElementById('scoreDisplay').textContent = `Điểm: ${score}`;
                    frameCount++;

                    requestAnimationFrame(updateGame);
                }

                function startGame() {
                    gameRunning = true;
                    score = 0;
                    frameCount = 0;
                    createBlocks();
                    document.getElementById('scoreDisplay').textContent = `Điểm: ${score}`;
                    updateGame();
                }

                canvas.addEventListener('touchstart', (e) => {
                    if (!gameRunning) return;
                    e.preventDefault();
                    const rect = canvas.getBoundingClientRect();
                    const touchX = e.touches[0].clientX - rect.left;
                    const touchY = e.touches[0].clientY - rect.top;

                    blocks = blocks.filter(block => {
                        if (
                            touchX >= block.x &&
                            touchX <= block.x + block.width &&
                            touchY >= block.y &&
                            touchY <= block.y + block.height
                        ) {
                            score += 10;
                            return false;
                        }
                        return true;
                    });

                    if (blocks.length === 0) {
                        gameRunning = false;
                        updateHighScore();
                        alert(`Chúc mừng! Điểm: ${score}, Điểm cao: ${localStorage.getItem('highScore') || 0}`);
                        createBlocks();
                    }
                });
            }
        }

        // Details section
        function formatTime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateDetails() {
            const startTime = sessionStorage.getItem('startTime') ? parseInt(sessionStorage.getItem('startTime')) : Date.now();
            if (!sessionStorage.getItem('startTime')) {
                sessionStorage.setItem('startTime', startTime);
            }
            const currentTime = Date.now();
            const sessionTime = Math.floor((currentTime - startTime) / 1000);
            const currentDateTime = new Date().toLocaleString('vi-VN', { timeZone: 'Asia/Ho_Chi_Minh' });
            const deviceInfo = navigator.userAgent;
            const platform = navigator.platform || 'Không xác định';

            const detailsContent = `
                <p><strong>Cổng thông tin:</strong> <span>Xứ Đoàn Các Thánh Tử Đạo Việt Nam</span></p>
                <p><strong>Giáo Xứ:</strong> <span>Chánh Tòa Mỹ Tho</span></p>
                <p><strong>Phiên bản thiết bị:</strong> <span>${deviceInfo}</span></p>
                <p><strong>Thời gian dùng:</strong> <span>${formatTime(sessionTime)} (Cập nhật: ${currentDateTime})</span></p>
                <p><strong>Vị trí thiết bị:</strong> <span>${platform}</span></p>
                <p><strong>Được thiết kế bởi:</strong> <span>Ban Truyền thông và Ban Kỹ thuật</span></p>
            `;
            document.getElementById('detailsContent').innerHTML = detailsContent;
            document.getElementById('detailsPopup').innerHTML = detailsContent;
        }

        setInterval(updateDetails, 60000);

        // Section navigation
        const sections = ['home', 'calendar', 'submit', 'game', 'feedback', 'resources', 'details', 'guide', 'lookup', 'redeem'];
        function showSection(sectionId) {
            sections.forEach(id => {
                const section = document.getElementById(id);
                if (section) section.classList.remove('active');
            });
            const targetSection = document.getElementById(sectionId);
            if (targetSection) targetSection.classList.add('active');
            document.querySelectorAll('.navbar a, .menu-panel a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href').substring(1) === sectionId) {
                    link.classList.add('active');
                }
            });

            if (sectionId === 'details') {
                updateDetails();
                const detailsSection = document.getElementById('details');
                let touchTimeout;
                const showPopup = () => {
                    document.getElementById('detailsPopup').style.display = 'block';
                };
                detailsSection.addEventListener('click', showPopup);
                detailsSection.addEventListener('touchstart', () => {
                    touchTimeout = setTimeout(showPopup, 500);
                });
                detailsSection.addEventListener('touchend', () => {
                    clearTimeout(touchTimeout);
                    document.getElementById('detailsPopup').style.display = 'none';
                });
                detailsSection.addEventListener('touchcancel', () => {
                    clearTimeout(touchTimeout);
                    document.getElementById('detailsPopup').style.display = 'none';
                });
            } else {
                document.getElementById('detailsPopup').style.display = 'none';
            }

            if (isMobile) {
                toggleMenuPanel(false);
            }
        }

        // Navbar toggle
        document.querySelectorAll('.navbar a, .menu-panel a').forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                const href = link.getAttribute('href').substring(1);
                if (href === 'more' && isMobile) {
                    toggleMenuPanel(true);
                } else if (href === 'back' && isMobile) {
                    toggleMenuPanel(false);
                    showSection('home');
                } else if (href === 'feedback' && isMobile) {
                    window.open('https://m.me/tnttchanhtoamytho', '_blank');
                } else {
                    showSection(href);
                }
            });
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadUsersData();
            loadCalendarData();
            loadDailyPrayer();
            loadResources();
            loadGifts();
            showSection('home');
            updateNavbar();
            if (isMobile) {
                document.getElementById('highScore').textContent = localStorage.getItem('highScore') || 0;
            }
            updateDetails();
        });
    </script>
</body>
</html>
