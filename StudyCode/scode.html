<!DOCTYPE html>
<html lang="vi">
<head>
    <!-- Thiết lập metadata và liên kết tài nguyên -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Cổng thông tin học viên lập trình - Xứ Đoàn Các Thánh Tử Đạo Việt Nam - Giáo Xứ Chánh Tòa Mỹ Tho">
    <meta name="keywords" content="Xứ Đoàn, Giáo Xứ Chánh Tòa Mỹ Tho, Các Thánh Tử Đạo Việt Nam, học lập trình, cổng học viên">
    <title>Cổng Lập Trình - Xứ Đoàn Các Thánh Tử Đạo Việt Nam</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Times+New+Roman&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Định nghĩa biến CSS để tái sử dụng màu sắc và phong cách */
        :root {
            --primary: #A61C00; /* Màu đỏ tử đạo */
            --primary-dark: #7A1400; /* Màu đỏ đậm hơn */
            --accent: #F5C518; /* Màu vàng ánh kim */
            --dark-bg: #1A1A1A; /* Màu nền tối */
            --light-bg: #F5F5F5; /* Màu nền sáng */
            --text: #E0E0E0; /* Màu chữ tối */
            --text-light: #F5C518; /* Màu chữ sáng */
            --error: #EF4444; /* Màu lỗi */
        }

        /* Chế độ sáng */
        body.light-mode {
            --dark-bg: var(--light-bg);
            --text: var(--text-light);
            background: linear-gradient(135deg, #FFFFFF 0%, #F5F5F5 100%);
        }

        /* Thiết lập giao diện cơ bản cho body */
        body {
            background: linear-gradient(135deg, #2D2D2D 0%, #1A1A1A 100%); /* Nền gradient tối */
            font-family: 'Times New Roman', serif;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: var(--text);
            overflow-x: hidden;
            transition: background 0.3s ease;
        }

        /* Tối ưu font cho iOS */
        body.ios {
            font-family: -apple-system, 'SF Pro', 'Times New Roman', serif;
        }

        /* Popup thông báo quảng cáo */
        #thongbao-quangcao {
            position: fixed;
            bottom: 20px;
            right: 20px;
            max-width: 320px;
            background: #fff8e1;
            border: 1px solid #ffd54f;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 9999;
            animation: slideUp 0.3s ease-in-out;
        }
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        #thongbao-quangcao h4 {
            margin-top: 0;
            color: #d17b00;
            font-size: 16px;
        }
        #thongbao-quangcao p {
            margin: 10px 0;
            color: #333;
            line-height: 1.4;
        }
        #thongbao-quangcao img {
            display: block;
            max-width: 100%;
            margin: 10px 0;
        }
        #thongbao-quangcao button {
            background: #ff9800;
            border: none;
            color: white;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            float: right;
        }
        #thongbao-quangcao button:hover {
            background: #e68900;
        }

        /* Header chứa tiêu đề và mô tả trang */
        .header {
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--text);
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
            text-align: center;
        }
        .header h2 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }
        .theme-toggle {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Thanh điều hướng (navbar) */
        .navbar {
            background: var(--dark-bg);
            padding: 0.75rem;
            display: flex;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
        }
        .navbar a {
            color: var(--text);
            padding: 0.75rem 1.5rem;
            margin: 0 0.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s ease;
            position: relative;
        }
        .navbar a:hover {
            background: var(--primary);
            color: var(--accent);
            transform: scale(1.05);
        }
        .navbar a.active {
            background: var(--primary);
            color: var(--accent);
        }

        /* Container chính chứa nội dung */
        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 1.5rem;
            flex: 1;
        }

        /* Card chứa các phần nội dung */
        .card {
            background: var(--dark-bg);
            border: 1px solid #3C3C3C;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
            margin-bottom: 2rem;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .card.show {
            opacity: 1;
            transform: translateY(0);
        }
        .card h3 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            color: var(--accent);
            margin-bottom: 1.5rem;
        }

        /* Widget cầu nguyện */
        .prayer-widget {
            background: var(--primary);
            color: var(--text);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            text-align: center;
            font-style: italic;
        }

        /* Bảng kết quả học tập */
        .table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 1rem;
        }
        .table th, .table td {
            padding: 1rem;
            border: 1px solid #3C3C3C;
            text-align: left;
            font-size: 0.95rem;
        }
        .table th {
            background: var(--primary);
            color: var(--text);
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        .table td {
            background: var(--dark-bg);
        }
        .table tr:hover td {
            background: #2A2A2A;
        }

        /* Icon xếp hạng thành viên */
        .rank-icon {
            font-size: 1.2rem;
        }
        .rank-thanhvien { color: #B0B0B0; }
        .rank-vip { color: #FFD700; }
        .rank-silver { color: #C0C0C0; }
        .rank-gold { color: #FFD700; }
        .rank-diamond { color: #B9F2FF; }
        .rank-vvip { color: #FF69B4; }

        /* Lịch học */
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            background: var(--dark-bg);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .calendar div {
            padding: 0.75rem;
            text-align: center;
            border: 1px solid #3C3C3C;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .calendar .header {
            background: var(--primary);
            color: var(--text);
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        .calendar .has-event {
            background: var(--accent);
            color: #1A1A1A;
            font-weight: bold;
        }
        .calendar div:hover {
            background: #3C3C3C;
        }
        .calendar div a {
            font-size: 0.75rem;
            color: #60A5FA;
            display: block;
            margin-top: 4px;
        }

        /* Nút giao diện */
        .btn {
            background: var(--primary);
            color: var(--text);
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            transition: all 0.2s ease;
            position: relative;
        }
        .btn:hover {
            background: var(--primary-dark);
            color: var(--accent);
            transform: translateY(-2px);
        }
        .btn:active {
            transform: translateY(0);
        }

        /* Input và textarea */
        .input, .textarea, select.input {
            background: var(--dark-bg);
            border: 1px solid #3C3C3C;
            border-radius: 8px;
            padding: 0.75rem;
            color: var(--text);
            width: 100%;
            font-family: 'JetBrains Mono', monospace;
        }
        .textarea {
            resize: vertical;
            min-height: 150px;
            font-size: 0.9rem;
        }
        .file-input {
            background: var(--dark-bg);
            border: 1px solid #3C3C3C;
            border-radius: 8px;
            padding: 0.75rem;
            color: var(--text);
            width: 100%;
            font-family: 'Times New Roman', serif;
        }

        /* Footer */
        .footer {
            background: var(--dark-bg);
            color: var(--text);
            padding: 2rem 1rem;
            text-align: center;
            box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.3);
            margin-top: auto;
        }
        .footer p {
            margin: 0.2rem 0;
        }
        .highlight {
            color: var(--accent);
            font-weight: 700;
        }
        .contact {
            font-size: 10px;
            color: #D1D5DB;
        }

        /* Canvas cho game */
        #gameCanvas {
            display: block;
            margin: 0 auto;
            border: 1px solid var(--primary);
            border-radius: 8px;
            width: 200px;
            height: 150px;
        }

        /* Tùy chỉnh giao diện cho điện thoại */
        @media (max-width: 1024px) {
            :root {
                --primary: #A61C00;
                --accent: #F5C518;
            }
            #gameCanvas {
                width: 90vw;
                height: 150px;
            }
            .header h2 {
                font-size: 1.5rem;
            }
            .header p {
                font-size: 0.9rem;
            }
            .navbar {
                overflow-x: auto;
                white-space: nowrap;
            }
            .navbar a {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
                display: inline-flex;
                align-items: center;
                transition: transform 0.1s ease, background 0.1s ease;
            }
            .navbar a i {
                margin-right: 0.5rem;
            }
            .navbar a[href="#submit"] {
                display: none !important;
            }
            .navbar a[href="#game"] {
                display: inline-flex;
            }
            .card h3 {
                font-size: 1.3rem;
                font-weight: 600;
            }
            .table th, .table td {
                paddingMT: 0.5rem;
                font-size: 0.85rem;
            }
            .calendar div {
                padding: 0.5rem;
                font-size: 0.85rem;
            }
            #thongbao-quangcao {
                max-width: 90%;
                bottom: 10px;
                right: 10px;
                font-size: 12px;
                animation: slideUp 0.5s ease-in-out;
            }
            .btn:active, .navbar a:active {
                position: relative;
                overflow: hidden;
            }
            .btn:active::after, .navbar a:active::after {
                content: '';
                position: absolute;
                background: rgba(255, 255, 255, 0.3);
                width: 100px;
                height: 100px;
                border-radius: 50%;
                transform: scale(0);
                animation: ripple 0.3s linear;
            }
            @keyframes ripple {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
            #submit {
                display: none;
            }
            .btn:active {
                background: var(--accent);
                color: var(--dark-bg);
                transform: scale(0.98);
            }
            .footer p {
                font-size: 10px;
            }
            .footer .contact {
                font-size: 10px;
            }
            body.ios {
                font-family: -apple-system, 'SF Pro', 'Times New Roman', serif;
            }
            body.ios .navbar {
                position: fixed;
                bottom: 0;
                width: 100%;
                display: flex;
                justify-content: space-around;
                background: rgba(26, 26, 26, 0.95);
                backdrop-filter: blur(10px);
                box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.3);
            }
            body.ios .navbar a {
                flex: 1;
                text-align: center;
                padding: 0.5rem;
                font-size: 0.8rem;
                display: flex;
                flex-direction: column;
                align-items: center;
                transition: transform 0.1s ease-in-out, background 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
            }
            body.ios .navbar a:active {
                transform: scale(0.95);
                box-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
                background: rgba(166, 28, 0, 0.9);
            }
            body.ios .navbar a i {
                font-size: 1.2rem;
                margin-bottom: 0.2rem;
            }
            body.ios #thongbao-quangcao {
                bottom: 10px;
                left: 50%;
                transform: translateX(-50%);
                max-width: 90%;
                background: rgba(255, 248, 225, 0.8);
                backdrop-filter: blur(5px);
            }
            body.ios .btn {
                background: rgba(166, 28, 0, 0.9);
                backdrop-filter: blur(3px);
            }
            body.ios .btn:active {
                transform: scale(0.95);
                transition: transform 0.1s ease;
                box-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
            }
            body.ios #eventDetails {
                position: fixed;
                bottom: 20%;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(26, 26, 26, 0.95);
                backdrop-filter: blur(10px);
                padding: 1rem;
                border-radius: 12px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            }
            #game .mt-4 {
                font-size: 0.85rem;
                padding: 0.5rem;
            }
            #game .btn {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Popup thông báo thư ngỏ và mã QR -->
    <div id="thongbao-quangcao">
        <h4>THƯ NGỎ</h4>
        <p>
            Chào quý thành viên,<br>
            Chúng tôi là Ban Truyền Thông & Ban Kỹ Thuật của trang web Xứ Đoàn Các Thánh Tử Đạo Việt Nam - Giáo Xứ Chánh Tòa Mỹ Tho.<br><br>
            Đây là trang phi lợi nhuận nhằm kết nối truyền thông với thời đại mới. Các khóa học miễn phí được tổ chức nhằm giúp phát triển kỹ năng và kiến thức, tất cả do quý Trưởng phân công hướng dẫn.<br><br>
            Mong nhận được sự đóng góp và ủng hộ để duy trì hệ thống hoạt động.<br><br>
            <strong>Mã QR hỗ trợ ở bên dưới:</strong>
        </p>
        <img id="qrCode" src="Qr_Code.jpg" alt="Mã QR hỗ trợ">
        <button onclick="document.getElementById('thongbao-quangcao').style.display='none'">Đóng</button>
    </div>

    <!-- Header với tiêu đề, mô tả và nút chế độ tối/sáng -->
    <div class="header">
        <button class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-sun"></i></button>
        <h2>XỨ ĐOÀN CÁC THÁNH TỬ ĐẠO VIỆT NAM</h2>
        <p>Cổng Lập Trình - Giáo Xứ Chánh Tòa Mỹ Tho</p>
    </div>

    <!-- Thanh điều hướng với các mục -->
    <div class="navbar">
        <a href="#home" class="active"><i class="fas fa-home"></i> Trang Chủ</a>
        <a href="#calendar"><i class="fas fa-calendar"></i> Lịch Học</a>
        <a href="#submit"><i class="fas fa-upload"></i> Nộp Bài</a>
        <a href="#game" class="hidden"><i class="fas fa-gamepad"></i> Giải Trí</a>
        <a href="#feedback"><i class="fas fa-comment"></i> Phản Hồi</a>
        <a href="#resources"><i class="fas fa-book"></i> Tài Liệu</a>
    </div>

    <!-- Container chứa các section nội dung -->
    <div class="container">
        <!-- Section Trang Chủ: Widget cầu nguyện và kết quả học tập -->
        <div id="home" class="card">
            <div class="prayer-widget">
                <p id="dailyPrayer">“Kẻ nào bền chí đến cùng, kẻ ấy sẽ được cứu độ.” (Mt 24:13)</p>
            </div>
            <h3>Kết Quả Học Tập Khoá</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Tên</th>
                        <th>Hạng Thành Viên</th>
                        <th>Môn</th>
                        <th>Thời Lượng</th>
                        <th>Đã Hoàn Tất (%)</th>
                        <th>Điểm</th>
                    </tr>
                </thead>
                <tbody id="subjectsTable"></tbody>
            </table>
        </div>

        <!-- Section Lịch Học: Tìm kiếm và lịch -->
        <div id="calendar" class="card hidden">
            <h3>Lịch Học</h3>
            <div class="mb-4">
                <input type="text" id="calendarSearch" class="input" placeholder="Tìm kiếm môn học hoặc buổi...">
            </div>
            <div id="searchResults" class="mb-4"></div>
            <div class="flex justify-between mb-4">
                <button class="btn" onclick="prevMonth()">◄</button>
                <h4 id="monthYear" class="font-bold text-accent"></h4>
                <button class="btn" onclick="nextMonth()">►</button>
            </div>
            <div class="calendar" id="calendarGrid"></div>
            <div id="eventDetails" class="mt-4 text-text"></div>
        </div>

        <!-- Section Nộp Bài: Form nộp bài tập -->
        <div id="submit" class="card hidden">
            <h3>Nộp Bài</h3>
            <form id="codeForm" action="https://formsubmit.co/notification2411.huynhdutruong@gmail.com" method="POST" enctype="multipart/form-data">
                <div class="mb-4">
                    <label class="block mb-1 text-text relative">Họ và Tên: <span class="tooltip">Nhập tên đầy đủ hoặc tên Thánh</span></label>
                    <input type="text" name="fullName" id="codeFullName" class="input" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text relative">Ngôn Ngữ: <span class="tooltip">Chọn ngôn ngữ lập trình hoặc loại bài nộp</span></label>
                    <select name="language" class="input" required>
                        <option value="python">Python</option>
                        <option value="javascript">JavaScript</option>
                        <option value="html_css">HTML/CSS</option>
                        <option value="other">Khác (báo cáo, file)</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text relative">Mã Nguồn: <span class="tooltip">Dán mã nguồn (nếu có)</span></label>
                    <textarea name="codeContent" class="textarea" placeholder="Dán mã nguồn của bạn (nếu có)..."></textarea>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text relative">Link Bài Nộp: <span class="tooltip">Dán URL (Google Drive, GitHub, v.v.) nếu không dán code</span></label>
                    <input type="url" name="submissionLink" class="input" placeholder="https://...">
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text relative">File Báo Cáo: <span class="tooltip">Tải lên file (<100MB, PDF, ZIP, TXT, v.v.)</span></label>
                    <input type="file" name="submissionFile" id="submissionFile" class="file-input" accept=".pdf,.zip,.txt,.doc,.docx">
                </div>
                <input type="hidden" name="submissionTime" id="submissionTime">
                <button type="submit" class="btn">Gửi Bài</button>
            </form>
        </div>

        <!-- Section Giải Trí: Chứa game T-Rex (iOS) hoặc Blast Block (Android) -->
        <div id="game" class="card hidden">
            <h3 id="gameTitle">Game</h3>
            <canvas id="gameCanvas"></canvas>
            <div class="mt-4 text-center">
                <p id="gameInstructions"></p>
                <p id="scoreDisplay">Điểm: 0</p>
                <p id="highScoreDisplay">Điểm cao: <span id="highScore">0</span></p>
                <button class="btn" onclick="startGame()">Bắt Đầu Lại</button>
            </div>
        </div>

        <!-- Section Phản Hồi: Form gửi ý kiến -->
        <div id="feedback" class="card hidden">
            <h3>Phản Hồi</h3>
            <form id="feedbackForm" action="https://formsubmit.co/notification2411.huynhdutruong@gmail.com" method="POST">
                <div class="mb-4">
                    <label class="block mb-1 text-text relative">Họ và Tên: <span class="tooltip">Nhập tên đầy đủ hoặc tên Thánh</span></label>
                    <input type="text" name="fullName" id="feedbackFullName" class="input" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text relative">Gmail: <span class="tooltip">Nhập email để nhận phản hồi</span></label>
                    <input type="email" name="gmail" class="input" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text relative">Nội Dung (Tối đa 250 chữ): <span class="tooltip">Mô tả ý kiến của bạn</span></label>
                    <textarea name="content" class="textarea" maxlength="250" required></textarea>
                </div>
                <input type="hidden" name="submissionTime" id="feedbackSubmissionTime">
                <button type="submit" class="btn">Gửi Phản Hồi</button>
            </form>
        </div>

        <!-- Section Tài Liệu -->
        <div id="resources" class="card hidden">
            <h3>Tài Liệu</h3>
            <div id="resourcesList"></div>
        </div>
    </div>

    <!-- Footer chứa thông tin bản quyền và liên hệ -->
    <div class="footer">
        <p class="highlight">Bản quyền © 2025 - Xứ Đoàn Các Thánh Tử Đạo Việt Nam</p>
        <p>Giáo Xứ Chánh Tòa Mỹ Tho - Giáo Phận Mỹ Tho - Việt Nam</p>
        <p class="contact">Địa chỉ: 32 Hùng Vương, Phường 7, Thành phố Mỹ Tho, Tiền Giang</p>
    </div>

    <script>
        // Phát hiện thiết bị iOS hoặc Android
        const isIOS = navigator.userAgent.includes('iPhone') || navigator.userAgent.includes('iPad');
        const isAndroid = navigator.userAgent.includes('Android');
        if (isIOS) {
            document.body.classList.add('ios');
            document.getElementById('qrCode').src = 'Qr_Code.jpg';
            document.getElementById('gameTitle').textContent = 'Khủng Long Vượt Chướng Ngại Vật';
            document.getElementById('gameInstructions').innerHTML = 'Nhấn <strong>Space</strong> hoặc chạm màn hình để nhảy. Tránh các chướng ngại vật!';
        } else if (isAndroid) {
            document.body.classList.add('android');
            document.getElementById('qrCode').src = 'Qr_Code.webp';
            document.getElementById('gameTitle').textContent = 'Blast Block';
            document.getElementById('gameInstructions').innerHTML = 'Chạm vào các khối để phá chúng. Phá càng nhiều khối càng tốt!';
        }

        // Điều chỉnh kích thước canvas cho game
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        function resizeCanvas() {
            if (window.innerWidth <= 1024) {
                canvas.width = window.innerWidth * 0.9;
                canvas.height = 150;
            } else {
                canvas.width = 600;
                canvas.height = 200;
            }
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Ẩn liên kết Nộp Bài trên điện thoại và tablet
        window.addEventListener('load', () => {
            if (window.innerWidth <= 1024) {
                document.querySelector('.navbar a[href="#submit"]').style.display = 'none';
            }
        });
        window.addEventListener('resize', () => {
            if (window.innerWidth <= 1024) {
                document.querySelector('.navbar a[href="#submit"]').style.display = 'none';
            } else {
                document.querySelector('.navbar a[href="#submit"]').style.display = 'inline-flex';
            }
        });

        // Chế độ tối/sáng
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const isLight = document.body.classList.contains('light-mode');
            document.querySelector('.theme-toggle i').classList.toggle('fa-sun', !isLight);
            document.querySelector('.theme-toggle i').classList.toggle('fa-moon', isLight);
            localStorage.setItem('theme', isLight ? 'light' : 'dark');
        }
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                document.querySelector('.theme-toggle i').classList.add('fa-moon');
            }
        });

        // Widget cầu nguyện
        async function loadDailyPrayer() {
            try {
                const response = await fetch('data/prayers.json');
                if (!response.ok) throw new Error('Failed to load prayers.json');
                const prayers = await response.json();
                const today = new Date().getDay();
                document.getElementById('dailyPrayer').textContent = prayers[today % prayers.length].text;
            } catch (error) {
                console.error('Error loading prayers:', error);
                document.getElementById('dailyPrayer').textContent = '“Kẻ nào bền chí đến cùng, kẻ ấy sẽ được cứu độ.” (Mt 24:13)';
            }
        }

        // Tải dữ liệu thành viên từ users.json
        async function loadUsersData() {
            try {
                const response = await fetch('data/users.json');
                if (!response.ok) throw new Error('Failed to load users.json');
                const users = await response.json();
                populateSubjectsTable(users);
            } catch (error) {
                console.error('Error loading users data:', error);
                document.getElementById('subjectsTable').innerHTML = '<tr><td colspan="6">Không thể tải dữ liệu thành viên.</td></tr>';
            }
        }

        // Tải dữ liệu lịch học từ calendar.json
        let calendarData = [];
        async function loadCalendarData() {
            try {
                const response = await fetch('data/calendar.json');
                if (!response.ok) throw new Error('Failed to load calendar.json');
                calendarData = await response.json();
                renderCalendar(calendarData);
            } catch (error) {
                console.error('Error loading calendar data:', error);
                document.getElementById('calendarGrid').innerHTML = '<div class="col-span-7 text-center">Không thể tải lịch học.</div>';
            }
        }

        // Tìm kiếm lịch học
        document.getElementById('calendarSearch')?.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const results = calendarData.filter(event =>
                event.subject.toLowerCase().includes(query) ||
                event.session.toLowerCase().includes(query)
            );
            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = results.length ? results.map(event => `
                <p><strong>${event.date}</strong>: ${event.subject} (${event.session}, ${event.startTime} - ${event.endTime})
                ${event.videoLink ? `<a href="${event.videoLink}" target="_blank" class="text-blue-400">Xem Video</a>` : ''}</p>
            `).join('') : '<p>Không tìm thấy kết quả.</p>';
        });

        // Tải tài liệu từ resources.json
        async function loadResources() {
            try {
                const response = await fetch('data/resources.json');
                if (!response.ok) throw new Error('Failed to load resources.json');
                const resources = await response.json();
                const resourcesList = document.getElementById('resourcesList');
                resourcesList.innerHTML = resources.map(res => `
                    <div class="mb-2">
                        <a href="${res.url}" target="_blank" class="btn">${res.name}</a>
                        <p class="text-sm">${res.description}</p>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading resources:', error);
                document.getElementById('resourcesList').innerHTML = '<p>Không thể tải tài liệu.</p>';
            }
        }

        // Tính toán xếp hạng thành viên dựa trên tổng điểm
        function getMembershipRank(totalScore) {
            if (totalScore < 50) return '<i class="fas fa-user rank-icon rank-thanhvien"></i>';
            if (totalScore < 100) return '<i class="fas fa-star rank-icon rank-vip"></i>';
            if (totalScore < 201) return '<i class="fas fa-medal rank-icon rank-silver"></i>';
            if (totalScore < 301) return '<i class="fas fa-medal rank-icon rank-gold"></i>';
            if (totalScore < 501) return '<i class="fas fa-gem rank-icon rank-diamond"></i>';
            return '<i class="fas fa-crown rank-icon rank-vvip"></i>';
        }

        // Hiển thị bảng kết quả học tập
        function populateSubjectsTable(users) {
            const subjectsTable = document.getElementById('subjectsTable');
            subjectsTable.innerHTML = '';
            users.members.forEach(member => {
                const totalScore = member.subjects.reduce((sum, subject) => sum + subject.score, 0);
                const rank = getMembershipRank(totalScore);
                member.subjects.forEach(subject => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${member.fullName}</td>
                        <td>${rank}</td>
                        <td>${subject.name}</td>
                        <td>${subject.duration}</td>
                        <td>${subject.completion}%</td>
                        <td>${subject.score}</td>
                    `;
                    subjectsTable.appendChild(row);
                });
            });
        }

        // Hiển thị lịch học theo tháng
        let currentDate = new Date();
        function renderCalendar(calendarData) {
            const calendarGrid = document.getElementById('calendarGrid');
            const monthYear = document.getElementById('monthYear');
            calendarGrid.innerHTML = '';

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            monthYear.textContent = `${month + 1}-${year}`;

            const days = ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'];
            days.forEach(day => {
                const div = document.createElement('div');
                div.textContent = day;
                div.classList.add('header');
                calendarGrid.appendChild(div);
            });

            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) {
                calendarGrid.appendChild(document.createElement('div'));
            }

            for (let date = 1; date <= lastDate; date++) {
                const div = document.createElement('div');
                div.textContent = date;
                const event = calendarData.find(e => {
                    const eventDate = new Date(e.date);
                    return eventDate.getDate() === date && eventDate.getMonth() === month && eventDate.getFullYear() === year;
                });
                if (event) {
                    div.classList.add('has-event');
                    if (event.videoLink) {
                        div.innerHTML += `<a href="${event.videoLink}" target="_blank" class="text-blue-400 text-xs">Xem Video</a>`;
                    }
                    div.addEventListener('click', () => {
                        document.getElementById('eventDetails').innerHTML = `
                            <p><strong>Môn:</strong> ${event.subject}</p>
                            <p><strong>Thời gian:</strong> Từ ${event.startTime} đến ${event.endTime}</p>
                            <p><strong>Buổi:</strong> ${event.session}</p>
                            ${event.videoLink ? `<p><a href="${event.videoLink}" target="_blank" class="text-blue-400">Xem Video</a></p>` : ''}
                        `;
                    });
                    div.addEventListener('touchstart', function(e) {
                        if (document.body.classList.contains('android')) {
                            setTimeout(() => {
                                if (div.classList.contains('has-event')) {
                                    div.click();
                                }
                            }, 500);
                        }
                    });
                }
                calendarGrid.appendChild(div);
            }
        }

        // Chuyển tháng trước
        function prevMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            loadCalendarData();
        }

        // Chuyển tháng sau
        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            loadCalendarData();
        }

        // Xử lý gửi form nộp bài
        document.getElementById('codeForm').addEventListener('submit', (e) => {
            const fileInput = document.getElementById('submissionFile');
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                if (file.size > 100 * 1024 * 1024) {
                    e.preventDefault();
                    alert('File quá lớn! Vui lòng chọn file dưới 100MB.');
                    return;
                }
            }
            document.getElementById('submissionTime').value = new Date().toLocaleString('vi-VN');
        });

        // Xử lý gửi form phản hồi
        document.getElementById('feedbackForm').addEventListener('submit', () => {
            document.getElementById('feedbackSubmissionTime').value = new Date().toLocaleString('vi-VN');
        });

        // Logic game (không có âm thanh)
        let gameRunning = false;
        let score = 0;
        let frameCount = 0;

        if (isIOS) {
            // Game T-Rex cho iOS
            let dino = { x: 50, y: 120, width: 40, height: 40, dy: 0, gravity: 0.5, jumpPower: -12, grounded: true };
            let obstacles = [];

            function drawDino() {
                ctx.fillStyle = 'white';
                ctx.fillRect(dino.x, dino.y, dino.width, dino.height);
            }

            function drawObstacles() {
                ctx.fillStyle = 'green';
                obstacles.forEach(obstacle => {
                    ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                });
            }

            function spawnObstacle() {
                const obstacle = { x: canvas.width, y: 120, width: 15, height: 30, speed: 3 };
                obstacles.push(obstacle);
            }

            function updateGame() {
                if (!gameRunning) return;

                ctx.clearRect(0, 0, canvas.width, canvas.height);

                dino.dy += dino.gravity;
                dino.y += dino.dy;
                if (dino.y > 120) {
                    dino.y = 120;
                    dino.dy = 0;
                    dino.grounded = true;
                }
                drawDino();

                if (frameCount % 60 === 0) {
                    spawnObstacle();
                }
                obstacles.forEach(obstacle => {
                    obstacle.x -= obstacle.speed;
                });
                obstacles = obstacles.filter(obstacle => obstacle.x + obstacle.width > 0);
                drawObstacles();

                for (let obstacle of obstacles) {
                    if (
                        dino.x < obstacle.x + obstacle.width &&
                        dino.x + dino.width > obstacle.x &&
                        dino.y < obstacle.y + obstacle.height &&
                        dino.y + dino.height > obstacle.y
                    ) {
                        gameRunning = false;
                        updateHighScore();
                        alert(`Game Over! Điểm: ${score}, Điểm cao: ${localStorage.getItem('highScore') || 0}`);
                        return;
                    }
                }

                score = Math.floor(frameCount / 10);
                document.getElementById('scoreDisplay').textContent = `Điểm: ${score}`;
                frameCount++;

                requestAnimationFrame(updateGame);
            }

            function startGame() {
                gameRunning = true;
                score = 0;
                frameCount = 0;
                dino.y = 120;
                dino.dy = 0;
                dino.grounded = true;
                obstacles = [];
                document.getElementById('scoreDisplay').textContent = `Điểm: ${score}`;
                updateGame();
            }

            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space' && dino.grounded && gameRunning) {
                    dino.dy = dino.jumpPower;
                    dino.grounded = false;
                }
            });

            canvas.addEventListener('touchstart', () => {
                if (dino.grounded && gameRunning) {
                    dino.dy = dino.jumpPower;
                    dino.grounded = false;
                }
            });
        } else if (isAndroid) {
            // Game Blast Block cho Android
            let blocks = [];
            const blockSize = 40;
            const rows = Math.floor(canvas.height / blockSize);
            const cols = Math.floor(canvas.width / blockSize);

            function createBlocks() {
                blocks = [];
                for (let row = 0; row < rows; row++) {
                    for (let col = 0; col < cols; col++) {
                        if (Math.random() > 0.5) {
                            blocks.push({
                                x: col * blockSize,
                                y: row * blockSize,
                                width: blockSize,
                                height: blockSize,
                                color: `hsl(${Math.random() * 360}, 70%, 50%)`
                            });
                        }
                    }
                }
            }

            function drawBlocks() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                blocks.forEach(block => {
                    ctx.fillStyle = block.color;
                    ctx.fillRect(block.x, block.y, block.width - 2, block.height - 2);
                });
            }

            function updateGame() {
                if (!gameRunning) return;

                drawBlocks();

                document.getElementById('scoreDisplay').textContent = `Điểm: ${score}`;
                frameCount++;

                requestAnimationFrame(updateGame);
            }

            function startGame() {
                gameRunning = true;
                score = 0;
                frameCount = 0;
                createBlocks();
                document.getElementById('scoreDisplay').textContent = `Điểm: ${score}`;
                updateGame();
            }

            canvas.addEventListener('touchstart', (e) => {
                if (!gameRunning) return;
                const rect = canvas.getBoundingClientRect();
                const touchX = e.touches[0].clientX - rect.left;
                const touchY = e.touches[0].clientY - rect.top;

                blocks = blocks.filter(block => {
                    if (
                        touchX >= block.x &&
                        touchX <= block.x + block.width &&
                        touchY >= block.y &&
                        touchY <= block.y + block.height
                    ) {
                        score += 10;
                        return false;
                    }
                    return true;
                });

                if (blocks.length === 0) {
                    gameRunning = false;
                    updateHighScore();
                    alert(`Chúc mừng! Điểm: ${score}, Điểm cao: ${localStorage.getItem('highScore') || 0}`);
                }
            });

            document.addEventListener('click', (e) => {
                if (!gameRunning) return;
                const rect = canvas.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const clickY = e.clientY - rect.top;

                blocks = blocks.filter(block => {
                    if (
                        clickX >= block.x &&
                        clickX <= block.x + block.width &&
                        clickY >= block.y &&
                        clickY <= block.y + block.height
                    ) {
                        score += 10;
                        return false;
                    }
                    return true;
                });

                if (blocks.length === 0) {
                    gameRunning = false;
                    updateHighScore();
                    alert(`Chúc mừng! Điểm: ${score}, Điểm cao: ${localStorage.getItem('highScore') || 0}`);
                }
            });
        }

        // Cập nhật điểm cao
        function updateHighScore() {
            const highScore = localStorage.getItem('highScore') || 0;
            if (score > highScore) {
                localStorage.setItem('highScore', score);
                document.getElementById('highScore').textContent = score;
            }
        }

        // Điều hướng giữa các section
        const sections = ['home', 'calendar', 'submit', 'game', 'feedback', 'resources'];
        function showSection(sectionId) {
            sections.forEach(id => {
                const section = document.getElementById(id);
                section.classList.add('hidden');
                section.classList.remove('show');
            });
            const activeSection = document.getElementById(sectionId);
            activeSection.classList.remove('hidden');
            setTimeout(() => activeSection.classList.add('show'), 10);
            document.querySelectorAll('.navbar a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href').substring(1) === sectionId) {
                    link.classList.add('active');
                }
            });
        }

        // Xử lý sự kiện click trên navbar
        document.querySelectorAll('.navbar a').forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                const sectionId = link.getAttribute('href').substring(1);
                showSection(sectionId);
            });
        });

        // Khởi tạo trang
        document.addEventListener('DOMContentLoaded', () => {
            loadUsersData();
            loadCalendarData();
            loadDailyPrayer();
            loadResources();
            showSection('home');
            document.getElementById('highScore').textContent = localStorage.getItem('highScore') || 0;
        });
    </script>
</body>
</html>
