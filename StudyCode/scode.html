<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Cổng thông tin học viên lập trình - Xứ Đoàn Các Thánh Tử Đạo Việt Nam - Giáo Xứ Chánh Tòa Mỹ Tho">
    <meta name="keywords" content="Xứ Đoàn, Giáo Xứ Chánh Tòa Mỹ Tho, Các Thánh Tử Đạo Việt Nam, học lập trình, cổng học viên">
    <title>Cổng Học Viên Lập Trình - Xứ Đoàn Các Thánh Tử Đạo Việt Nam</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #cc3048;
            --primary-dark: #b7142a;
            --accent: #FFD700;
            --dark-bg: #1A1A1A;
            --text: #E0E0E0;
            --error: #EF4444;
        }

        body {
            background: linear-gradient(135deg, #2D2D2D 0%, #1A1A1A 100%);
            font-family: 'Roboto', sans-serif;
            margin: 0;
            color: var(--text);
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        body.ios {
            font-family: -apple-system, 'SF Pro', 'Roboto', sans-serif;
        }

        .header {
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--text);
            padding: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
            text-align: center;
        }
        .header h2 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.2rem;
        }
        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .navbar {
            background: var(--dark-bg);
            padding: 0.5rem;
            display: flex;
            justify-content: space-around;
            position: fixed;
            bottom: 0;
            width: 100%;
            box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }
        .navbar a {
            color: var(--text);
            padding: 0.5rem;
            font-size: 1rem;
            text-align: center;
            border-radius: 6px;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .navbar a i {
            font-size: 1.2rem;
            margin-bottom: 0.2rem;
        }
        .navbar a:hover {
            background: var(--primary);
            color: var(--accent);
            transform: scale(1.1);
        }
        .navbar a.active {
            background: var(--primary);
            color: var(--accent);
        }

        .container {
            flex: 1;
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 1rem;
            overflow-y: auto;
            height: calc(100vh - 60px - 60px); /* header: 60px, navbar: 60px */
        }

        .card {
            background: #252526;
            border: 1px solid #3C3C3C;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
            display: none;
            height: 100%;
            overflow-y: auto;
        }
        .card.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card h3 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            color: var(--accent);
            margin-bottom: 1.5rem;
        }

        .prayer-widget {
            background: var(--primary);
            color: var(--text);
            padding: 0.8rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            text-align: center;
            font-style: italic;
            font-size: 0.9rem;
        }

        .table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 1rem;
        }
        .table th, .table td {
            padding: 0.75rem;
            border: 1px solid #3C3C3C;
            text-align: left;
            font-size: 0.9rem;
        }
        .table th {
            background: var(--primary);
            color: var(--text);
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        .table td {
            background: #1E1E1E;
        }
        .table tr:hover td {
            background: #2A2A2A;
        }

        .rank-icon {
            font-size: 1.2rem;
        }
        .rank-thanhvien { color: #B0B0B0; }
        .rank-vip { color: #FFD700; }
        .rank-silver { color: #C0C0C0; }
        .rank-gold { color: #FFD700; }
        .rank-diamond { color: #B9F2FF; }
        .rank-vvip { color: #FF69B4; }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            background: #252526;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .calendar .header {
            background: var(--primary);
            color: var(--text);
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        .calendar div {
            padding: 0.5rem;
            text-align: center;
            border: 1px solid #3C3C3C;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        .calendar .has-event {
            background: var(--accent);
            color: #1A1A1A;
            font-weight: bold;
        }
        .calendar div:hover {
            background: #3C3C3C;
        }
        .calendar div a {
            font-size: 0.8rem;
            color: #60A5FA;
            display: block;
            margin-top: 2px;
        }

        #eventPopup, #detailsPopup {
            position: fixed;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(26, 26, 26, 0.95);
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            font-size: 0.9rem;
            z-index: 1000;
            display: none;
        }

        .btn {
            background: var(--primary);
            color: var(--text);
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .btn:hover {
            background: var(--primary-dark);
            color: var(--accent);
            transform: translateY(-2px);
        }
        .btn:active {
            transform: translateY(0);
        }

        .input, .textarea, select.input {
            background: #1E1E1E;
            border: 1px solid #3C3C3C;
            border-radius: 8px;
            padding: 0.75rem;
            color: var(--text);
            width: 100%;
            font-family: 'Roboto', sans-serif;
        }
        .textarea {
            resize: vertical;
            min-height: 150px;
            font-size: 0.9rem;
        }
        .file-input {
            background: #1E1E1E;
            border: 1px solid #3C3C3C;
            border-radius: 8px;
            padding: 0.75rem;
            color: var(--text);
            width: 100%;
            font-family: 'Roboto', sans-serif;
        }

        @media (max-width: 1024px) {
            :root {
                --primary: #e63950;
                --accent: #FFD54F;
            }
            body {
                overflow-y: hidden;
            }
            .header {
                padding: 0.5rem;
            }
            .header h2 {
                font-size: 1rem;
            }
            .header p {
                font-size: 0.7rem;
            }
            .navbar {
                padding: 0.3rem;
            }
            .navbar a {
                padding: 0.4rem;
                font-size: 0.8rem;
            }
            .navbar a i {
                font-size: 1rem;
            }
            .navbar a[href="#submit"] {
                display: none;
            }
            .container {
                margin: 0 auto;
                padding: 0.5rem;
                height: calc(100vh - 50px - 50px); /* header: 50px, navbar: 50px */
            }
            .card {
                padding: 1rem;
                height: 100%;
                overflow-y: auto;
            }
            .card h3 {
                font-size: 1.3rem;
            }
            .table th, .table td {
                padding: 0.5rem;
                font-size: 0.85rem;
            }
            .calendar div {
                padding: 0.4rem;
                font-size: 0.85rem;
            }
            .btn {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
            #gameCanvas {
                width: 90vw;
                height: 150px;
            }
            body.ios .navbar {
                background: rgba(26, 26, 26, 0.95);
                backdrop-filter: blur(10px);
            }
            body.ios .navbar a:active {
                transform: scale(0.95);
                box-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
                background: rgba(204, 48, 72, 0.9);
            }
            body.ios .btn:active {
                transform: scale(0.95);
                box-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
            }
            body.ios #eventPopup, body.ios #detailsPopup {
                bottom: 20%;
            }
            #submit {
                display: none;
            }
        }

        @media (min-width: 1025px) {
            .navbar a[href="#game"] {
                display: none;
            }
            #game {
                display: none;
            }
            .navbar a:hover {
                background: linear-gradient(45deg, var(--primary), var(--accent));
            }
            .textarea {
                min-height: 200px;
                font-size: 1rem;
            }
            .container {
                height: calc(100vh - 80px - 60px); /* header: 80px, navbar: 60px */
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h2>XỨ ĐOÀN CÁC THÁNH TỬ ĐẠO VIỆT NAM</h2>
        <p>Cổng Học Viên Lập Trình - Giáo Xứ Chánh Tòa Mỹ Tho</p>
    </div>

    <div class="navbar">
        <a href="#home" class="active"><i class="fas fa-home"></i><span>Trang Chủ</span></a>
        <a href="#calendar"><i class="fas fa-calendar"></i><span>Lịch Học</span></a>
        <a href="#submit"><i class="fas fa-upload"></i><span>Nộp Bài</span></a>
        <a href="#game"><i class="fas fa-gamepad"></i><span>Giải Trí</span></a>
        <a href="#feedback"><i class="fas fa-comment"></i><span>Phản Hồi</span></a>
        <a href="#resources"><i class="fas fa-book"></i><span>Tài Liệu</span></a>
        <a href="#details"><i class="fas fa-info-circle"></i><span>Chi Tiết</span></a>
    </div>

    <div class="container">
        <div id="home" class="card active">
            <div class="prayer-widget">
                <p id="dailyPrayer">“Kẻ nào bền chí đến cùng, kẻ ấy sẽ được cứu độ.” (Mt 24:13)</p>
            </div>
            <h3>Kết Quả Học Tập</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Tên</th>
                        <th>Hạng</th>
                        <th>Môn</th>
                        <th>Thời Lượng</th>
                        <th>Hoàn Tất (%)</th>
                        <th>Điểm</th>
                    </tr>
                </thead>
                <tbody id="subjectsTable"></tbody>
            </table>
        </div>

        <div id="calendar" class="card">
            <h3>Lịch Học</h3>
            <div class="mb-4">
                <input type="text" id="calendarSearch" class="input" placeholder="Tìm môn học hoặc buổi...">
            </div>
            <div id="searchResults" class="mb-4"></div>
            <div class="flex justify-between mb-4">
                <button class="btn" onclick="prevMonth()">◄</button>
                <h4 id="monthYear" class="font-bold text-accent"></h4>
                <button class="btn" onclick="nextMonth()">►</button>
            </div>
            <div class="calendar" id="calendarGrid"></div>
            <div id="eventPopup"></div>
        </div>

        <div id="submit" class="card">
            <h3>Nộp Bài</h3>
            <form id="codeForm" action="https://formsubmit.co/notification2411.huynhdutruong@gmail.com" method="POST" enctype="multipart/form-data">
                <div class="mb-4">
                    <label class="block mb-1 text-text">Họ và Tên:</label>
                    <input type="text" name="fullName" id="codeFullName" class="input" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text">Ngôn Ngữ:</label>
                    <select name="language" class="input" required>
                        <option value="python">Python</option>
                        <option value="javascript">JavaScript</option>
                        <option value="html_css">HTML/CSS</option>
                        <option value="other">Khác</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text">Mã Nguồn:</label>
                    <textarea name="codeContent" class="textarea" placeholder="Dán mã nguồn..."></textarea>
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text">Link Bài Nộp:</label>
                    <input type="url" name="submissionLink" class="input" placeholder="https://...">
                </div>
                <div class="mb-4">
                    <label class="block mb-1 text-text">File Báo Cáo:</label>
                    <input type="file" name="submissionFile" id="submissionFile" class="file-input" accept=".pdf,.zip,.txt,.doc,.docx">
                </div>
                <input type="hidden" name="submissionTime" id="submissionTime">
                <button type="submit" class="btn">Gửi Bài</button>
            </form>
        </div>

        <div id="game" class="card">
            <h3>Game</h3>
            <canvas id="gameCanvas"></canvas>
            <div class="mt-4 text-center">
                <p id="gameInstructions"></p>
                <p id="scoreDisplay">Điểm: 0</p>
                <p id="highScoreDisplay">Điểm cao: <span id="highScore">0</span></p>
                <button class="btn" onclick="startGame()">Bắt Đầu Lại</button>
            </div>
        </div>

        <div id="feedback" class="card">
            <h3>Phản Hồi</h3>
            <div id="feedbackContent"></div>
        </div>

        <div id="resources" class="card">
            <h3>Tài Liệu</h3>
            <div id="resourcesList"></div>
        </div>

        <div id="details" class="card">
            <h3>Thông Tin Chi Tiết</h3>
            <div id="detailsContent"></div>
            <div id="detailsPopup"></div>
        </div>
    </div>

    <script>
        const isMobile = window.innerWidth <= 1024;
        const isIOS = navigator.userAgent.includes('iPhone') || navigator.userAgent.includes('iPad');
        const isAndroid = navigator.userAgent.includes('Android');

        // Load feedback content based on device
        if (isMobile) {
            document.getElementById('feedbackContent').innerHTML = `
                <p>Nhấn vào nút dưới để gửi phản hồi qua Messenger:</p>
                <a href="https://m.me/tnttchanhtoamytho" target="_blank" class="btn">Gửi Phản Hồi</a>
            `;
        } else {
            document.getElementById('feedbackContent').innerHTML = `
                <form id="feedbackForm" action="https://formsubmit.co/notification2411.huynhdutruong@gmail.com" method="POST">
                    <div class="mb-4">
                        <label class="block mb-1 text-text">Họ và Tên:</label>
                        <input type="text" name="fullName" id="feedbackFullName" class="input" required>
                    </div>
                    <div class="mb-4">
                        <label class="block mb-1 text-text">Gmail:</label>
                        <input type="email" name="gmail" class="input" required>
                    </div>
                    <div class="mb-4">
                        <label class="block mb-1 text-text">Nội Dung (Tối đa 250 chữ):</label>
                        <textarea name="content" class="textarea" maxlength="250" required></textarea>
                    </div>
                    <input type="hidden" name="submissionTime" id="feedbackSubmissionTime">
                    <button type="submit" class="btn">Gửi Phản Hồi</button>
                </form>
            `;
        }

        // Set game instructions based on device
        if (isIOS && isMobile) {
            document.getElementById('gameInstructions').textContent = 'Chạm màn hình để nhảy!';
        } else if (isAndroid && isMobile) {
            document.getElementById('gameInstructions').textContent = 'Chạm để phá khối!';
        }

        // Resize canvas for game
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        function resizeCanvas() {
            if (window.innerWidth <= 1024) {
                canvas.width = window.innerWidth * 0.9;
                canvas.height = 150;
            } else {
                canvas.width = 600;
                canvas.height = 200;
            }
        }
        window.addEventListener('resize', () => {
            resizeCanvas();
            if (window.innerWidth <= 1024) {
                document.querySelector('.navbar a[href="#submit"]').style.display = 'none';
            } else {
                document.querySelector('.navbar a[href="#submit"]').style.display = 'inline-flex';
                document.querySelector('.navbar a[href="#game"]').style.display = 'none';
            }
        });
        resizeCanvas();

        // Load daily prayer
        async function loadDailyPrayer() {
            try {
                const response = await fetch('data/prayers.json');
                if (!response.ok) throw new Error('Failed to load prayers.json');
                const prayers = await response.json();
                const today = new Date().getDay();
                document.getElementById('dailyPrayer').textContent = prayers[today % prayers.length].text;
            } catch (error) {
                console.error('Error loading prayers:', error);
                document.getElementById('dailyPrayer').textContent = '“Kẻ nào bền chí đến cùng, kẻ ấy sẽ được cứu độ.” (Mt 24:13)';
            }
        }

        // Load users data
        async function loadUsersData() {
            try {
                const response = await fetch('data/users.json');
                if (!response.ok) throw new Error('Failed to load users.json');
                const users = await response.json();
                populateSubjectsTable(users);
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('subjectsTable').innerHTML = '<tr><td colspan="6">Không thể tải dữ liệu.</td></tr>';
            }
        }

        // Load calendar data
        let calendarData = [];
        async function loadCalendarData() {
            try {
                const response = await fetch('data/calendar.json');
                if (!response.ok) throw new Error('Failed to load calendar.json');
                calendarData = await response.json();
                renderCalendar(calendarData);
            } catch (error) {
                console.error('Error loading calendar:', error);
                document.getElementById('calendarGrid').innerHTML = '<div class="col-span-7 text-center">Không thể tải lịch.</div>';
            }
        }

        // Calendar search
        document.getElementById('calendarSearch')?.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const results = calendarData.filter(event =>
                event.subject.toLowerCase().includes(query) ||
                event.session.toLowerCase().includes(query)
            );
            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = results.length ? results.map(event => `
                <p><strong>${event.date}</strong>: ${event.subject} (${event.session}, ${event.startTime} - ${event.endTime})
                ${event.videoLink ? `<a href="${event.videoLink}" target="_blank" class="text-blue-400">Xem Video</a>` : ''}</p>
            `).join('') : '<p>Không tìm thấy.</p>';
        });

        // Load resources
        async function loadResources() {
            try {
                const response = await fetch('data/resources.json');
                if (!response.ok) throw new Error('Failed to load resources.json');
                const resources = await response.json();
                const resourcesList = document.getElementById('resourcesList');
                resourcesList.innerHTML = resources.map(res => `
                    <div class="mb-2">
                        <a href="${res.url}" target="_blank" class="btn">${res.name}</a>
                        <p class="text-sm">${res.description}</p>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading resources:', error);
                document.getElementById('resourcesList').innerHTML = '<p>Không thể tải tài liệu.</p>';
            }
        }

        // Membership rank logic
        function getMembershipRank(totalScore) {
            if (totalScore < 50) return '<i class="fas fa-user rank-icon rank-thanhvien"></i>';
            if (totalScore < 100) return '<i class="fas fa-star rank-icon rank-vip"></i>';
            if (totalScore < 201) return '<i class="fas fa-medal rank-icon rank-silver"></i>';
            if (totalScore < 301) return '<i class="fas fa-medal rank-icon rank-gold"></i>';
            if (totalScore < 501) return '<i class="fas fa-gem rank-icon rank-diamond"></i>';
            return '<i class="fas fa-crown rank-icon rank-vvip"></i>';
        }

        // Populate subjects table
        function populateSubjectsTable(users) {
            const subjectsTable = document.getElementById('subjectsTable');
            subjectsTable.innerHTML = '';
            users.members.forEach(member => {
                const totalScore = member.subjects.reduce((sum, subject) => sum + subject.score, 0);
                const rank = getMembershipRank(totalScore);
                member.subjects.forEach(subject => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${member.fullName}</td>
                        <td>${rank}</td>
                        <td>${subject.name}</td>
                        <td>${subject.duration}</td>
                        <td>${subject.completion}%</td>
                        <td>${subject.score}</td>
                    `;
                    subjectsTable.appendChild(row);
                });
            });
        }

        // Render calendar
        let currentDate = new Date();
        function renderCalendar(calendarData) {
            const calendarGrid = document.getElementById('calendarGrid');
            const monthYear = document.getElementById('monthYear');
            calendarGrid.innerHTML = '';

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            monthYear.textContent = `${month + 1}-${year}`;

            const days = ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'];
            days.forEach(day => {
                const div = document.createElement('div');
                div.textContent = day;
                div.classList.add('header');
                calendarGrid.appendChild(div);
            });

            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) {
                calendarGrid.appendChild(document.createElement('div'));
            }

            for (let date = 1; date <= lastDate; date++) {
                const div = document.createElement('div');
                div.textContent = date;
                const event = calendarData.find(e => {
                    const eventDate = new Date(e.date);
                    return eventDate.getDate() === date && eventDate.getMonth() === month && eventDate.getFullYear() === year;
                });
                if (event) {
                    div.classList.add('has-event');
                    if (event.videoLink) {
                        div.innerHTML += `<a href="${event.videoLink}" target="_blank" class="text-blue-400 text-xs">Video</a>`;
                    }
                    const showEvent = () => {
                        document.getElementById('eventPopup').innerHTML = `
                            <p><strong>Môn:</strong> ${event.subject}</p>
                            <p><strong>Thời gian:</strong> ${event.startTime} - ${event.endTime}</p>
                            <p><strong>Buổi:</strong> ${event.session}</p>
                            ${event.videoLink ? `<p><a href="${event.videoLink}" target="_blank" class="text-blue-400">Xem Video</a></p>` : ''}
                        `;
                        document.getElementById('eventPopup').style.display = 'block';
                    };
                    div.addEventListener('click', showEvent);
                    let touchTimeout;
                    div.addEventListener('touchstart', () => {
                        touchTimeout = setTimeout(showEvent, 500);
                    });
                    div.addEventListener('touchend', () => {
                        clearTimeout(touchTimeout);
                        document.getElementById('eventPopup').style.display = 'none';
                    });
                    div.addEventListener('touchcancel', () => {
                        clearTimeout(touchTimeout);
                        document.getElementById('eventPopup').style.display = 'none';
                    });
                }
                calendarGrid.appendChild(div);
            }
        }

        function prevMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar(calendarData);
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar(calendarData);
        }

        // Form submission handling
        document.getElementById('codeForm').addEventListener('submit', (e) => {
            const fileInput = document.getElementById('submissionFile');
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                if (file.size > 100 * 1024 * 1024) {
                    e.preventDefault();
                    alert('File quá lớn! Vui lòng chọn file dưới 100MB.');
                    return;
                }
            }
            document.getElementById('submissionTime').value = new Date().toLocaleString('vi-VN');
        });

        if (!isMobile) {
            document.getElementById('feedbackForm')?.addEventListener('submit', () => {
                document.getElementById('feedbackSubmissionTime').value = new Date().toLocaleString('vi-VN');
            });
        }

        // Game logic
        let gameRunning = false;
        let score = 0;
        let frameCount = 0;

        if (isMobile) {
            if (isIOS) {
                let dino = { x: 50, y: 120, width: 30, height: 30, dy: 0, gravity: 0.6, jumpPower: -10, grounded: true };
                let obstacles = [];

                function drawDino() {
                    ctx.fillStyle = 'white';
                    ctx.fillRect(dino.x, dino.y, dino.width, dino.height);
                }

                function drawObstacles() {
                    ctx.fillStyle = 'green';
                    obstacles.forEach(obstacle => {
                        ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                    });
                }

                function spawnObstacle() {
                    const obstacle = { x: canvas.width, y: 120, width: 15, height: 30, speed: 4 };
                    obstacles.push(obstacle);
                }

                function updateGame() {
                    if (!gameRunning) return;

                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    dino.dy += dino.gravity;
                    dino.y += dino.dy;
                    if (dino.y > 120) {
                        dino.y = 120;
                        dino.dy = 0;
                        dino.grounded = true;
                    }
                    drawDino();

                    if (frameCount % 60 === 0) {
                        spawnObstacle();
                    }
                    obstacles.forEach(obstacle => {
                        obstacle.x -= obstacle.speed;
                    });
                    obstacles = obstacles.filter(obstacle => obstacle.x + obstacle.width > 0);
                    drawObstacles();

                    for (let obstacle of obstacles) {
                        if (
                            dino.x < obstacle.x + obstacle.width &&
                            dino.x + dino.width > obstacle.x &&
                            dino.y < obstacle.y + obstacle.height &&
                            dino.y + dino.height > obstacle.y
                        ) {
                            gameRunning = false;
                            updateHighScore();
                            alert(`Game Over! Điểm: ${score}, Điểm cao: ${localStorage.getItem('highScore') || 0}`);
                            return;
                        }
                    }

                    score = Math.floor(frameCount / 10);
                    document.getElementById('scoreDisplay').textContent = `Điểm: ${score}`;
                    frameCount++;

                    requestAnimationFrame(updateGame);
                }

                function startGame() {
                    gameRunning = true;
                    score = 0;
                    frameCount = 0;
                    dino.y = 120;
                    dino.dy = 0;
                    dino.grounded = true;
                    obstacles = [];
                    document.getElementById('scoreDisplay').textContent = `Điểm: ${score}`;
                    updateGame();
                }

                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space' && dino.grounded && gameRunning) {
                        dino.dy = dino.jumpPower;
                        dino.grounded = false;
                    }
                });

                canvas.addEventListener('touchstart', () => {
                    if (dino.grounded && gameRunning) {
                        dino.dy = dino.jumpPower;
                        dino.grounded = false;
                    }
                });
            } else if (isAndroid) {
                let blocks = [];
                const blockSize = 30;
                const rows = Math.floor(canvas.height / blockSize);
                const cols = Math.floor(canvas.width / blockSize);

                function createBlocks() {
                    blocks = [];
                    for (let row = 0; row < rows; row++) {
                        for (let col = 0; col < cols; col++) {
                            if (Math.random() > 0.3) {
                                blocks.push({
                                    x: col * blockSize,
                                    y: row * blockSize,
                                    width: blockSize,
                                    height: blockSize,
                                    color: `hsl(${Math.random() * 360}, 70%, 50%)`
                                });
                            }
                        }
                    }
                }

                function drawBlocks() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    blocks.forEach(block => {
                        ctx.fillStyle = block.color;
                        ctx.fillRect(block.x, block.y, block.width - 2, block.height - 2);
                    });
                }

                function updateGame() {
                    if (!gameRunning) return;

                    drawBlocks();

                    document.getElementById('scoreDisplay').textContent = `Điểm: ${score}`;
                    frameCount++;

                    requestAnimationFrame(updateGame);
                }

                function startGame() {
                    gameRunning = true;
                    score = 0;
                    frameCount = 0;
                    createBlocks();
                    document.getElementById('scoreDisplay').textContent = `Điểm: ${score}`;
                    updateGame();
                }

                canvas.addEventListener('touchstart', (e) => {
                    if (!gameRunning) return;
                    const rect = canvas.getBoundingClientRect();
                    const touchX = e.touches[0].clientX - rect.left;
                    const touchY = e.touches[0].clientY - rect.top;

                    blocks = blocks.filter(block => {
                        if (
                            touchX >= block.x &&
                            touchX <= block.x + block.width &&
                            touchY >= block.y &&
                            touchY <= block.y + block.height
                        ) {
                            score += 10;
                            return false;
                        }
                        return true;
                    });

                    if (blocks.length === 0) {
                        gameRunning = false;
                        updateHighScore();
                        alert(`Chúc mừng! Điểm: ${score}, Điểm cao: ${localStorage.getItem('highScore') || 0}`);
                    }
                });

                document.addEventListener('click', (e) => {
                    if (!gameRunning) return;
                    const rect = canvas.getBoundingClientRect();
                    const clickX = e.clientX - rect.left;
                    const clickY = e.clientY - rect.top;

                    blocks = blocks.filter(block => {
                        if (
                            clickX >= block.x &&
                            clickX <= block.x + block.width &&
                            clickY >= block.y &&
                            clickY <= block.y + block.height
                        ) {
                            score += 10;
                            return false;
                        }
                        return true;
                    });

                    if (blocks.length === 0) {
                        gameRunning = false;
                        updateHighScore();
                        alert(`Chúc mừng! Điểm: ${score}, Điểm cao: ${localStorage.getItem('highScore') || 0}`);
                    }
                });
            }
        }

        // Update high score
        function updateHighScore() {
            const highScore = localStorage.getItem('highScore') || 0;
            if (score > highScore) {
                localStorage.setItem('highScore', score);
                document.getElementById('highScore').textContent = score;
            }
        }

        // Details section logic
        function formatTime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateDetails() {
            const startTime = sessionStorage.getItem('startTime') ? parseInt(sessionStorage.getItem('startTime')) : Date.now();
            if (!sessionStorage.getItem('startTime')) {
                sessionStorage.setItem('startTime', startTime);
            }
            const currentTime = Date.now();
            const sessionTime = Math.floor((currentTime - startTime) / 1000);
            const currentDateTime = new Date().toLocaleString('vi-VN', { timeZone: 'Asia/Ho_Chi_Minh' });
            const deviceInfo = navigator.userAgent;
            const platform = navigator.platform || 'Không xác định';

            document.getElementById('detailsContent').innerHTML = `
                <p><strong>Công thông tin:</strong> Xứ Đoàn Các Thánh Tử Đạo Việt Nam</p>
                <p><strong>Giáo Xứ:</strong> Chánh Tòa Mỹ Tho</p>
                <p><strong>Phiên bản thiết bị:</strong> ${deviceInfo}</p>
                <p><strong>Thời gian dùng:</strong> ${formatTime(sessionTime)} (Cập nhật: ${currentDateTime})</p>
                <p><strong>Vị trí thiết bị:</strong> ${platform}</p>
                <p><strong>Được thiết kế bởi:</strong> Ban Truyền thông và Ban Kỹ thuật</p>
            `;
        }

        setInterval(updateDetails, 60000); // Update every minute

        // Section navigation
        const sections = ['home', 'calendar', 'submit', 'game', 'feedback', 'resources', 'details'];
        function showSection(sectionId) {
            sections.forEach(id => {
                const section = document.getElementById(id);
                if (section) section.classList.remove('active');
            });
            const targetSection = document.getElementById(sectionId);
            if (targetSection) targetSection.classList.add('active');
            document.querySelectorAll('.navbar a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href').substring(1) === sectionId) {
                    link.classList.add('active');
                }
            });

            if (sectionId === 'details') {
                updateDetails();
                document.getElementById('detailsPopup').style.display = 'block';
                let touchTimeout;
                document.getElementById('details').addEventListener('click', () => {
                    document.getElementById('detailsPopup').style.display = 'block';
                });
                document.getElementById('details').addEventListener('touchstart', () => {
                    touchTimeout = setTimeout(() => {
                        document.getElementById('detailsPopup').style.display = 'block';
                    }, 500);
                });
                document.getElementById('details').addEventListener('touchend', () => {
                    clearTimeout(touchTimeout);
                    document.getElementById('detailsPopup').style.display = 'none';
                });
                document.getElementById('details').addEventListener('touchcancel', () => {
                    clearTimeout(touchTimeout);
                    document.getElementById('detailsPopup').style.display = 'none';
                });
            } else {
                document.getElementById('detailsPopup').style.display = 'none';
            }
        }

        document.querySelectorAll('.navbar a').forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                const sectionId = link.getAttribute('href').substring(1);
                if (sectionId === 'feedback' && isMobile) {
                    window.open('https://m.me/tnttchanhtoamytho', '_blank');
                } else {
                    showSection(sectionId);
                }
            });
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadUsersData();
            loadCalendarData();
            loadDailyPrayer();
            loadResources();
            showSection('home');
            if (isMobile) {
                document.getElementById('highScore').textContent = localStorage.getItem('highScore') || 0;
            }
            updateDetails();
        });
    </script>
</body>
</html>
